<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Statistics 243 Fall 2022 - Problem Set 7</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Statistics 243 Fall 2022</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html">Syllabus</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../office_hours.html">Office hours</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html">Schedule</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-units" role="button" data-bs-toggle="dropdown" aria-expanded="false">Units</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-units">    
        <li>
    <a class="dropdown-item" href="../units/unit1-intro.html">
 <span class="dropdown-text">Unit 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit2-dataTech.html">
 <span class="dropdown-text">Unit 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit3-bash.html">
 <span class="dropdown-text">Unit 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit4-goodPractices.html">
 <span class="dropdown-text">Unit 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit5-programming.html">
 <span class="dropdown-text">Unit 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit6-parallel.html">
 <span class="dropdown-text">Unit 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit7-bigData.html">
 <span class="dropdown-text">Unit 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit8-numbers.html">
 <span class="dropdown-text">Unit 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit9-sim.html">
 <span class="dropdown-text">Unit 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit10-linalg.html">
 <span class="dropdown-text">Unit 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="button" data-bs-toggle="dropdown" aria-expanded="false">Labs</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="../labs/01/intro_git_knitr.html">
 <span class="dropdown-text">Lab 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/02/assertionsAndTesting.html">
 <span class="dropdown-text">Lab 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/03/reproducibility.html">
 <span class="dropdown-text">Lab 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/04/debugging.html">
 <span class="dropdown-text">Lab 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/05/code_review.html">
 <span class="dropdown-text">Lab 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/06/scf.html">
 <span class="dropdown-text">Lab 6</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lab 7</li>
        <li>
    <a class="dropdown-item" href="../labs/07/python_intro.html">
 <span class="dropdown-text">Intro to Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/07/py_vs_R.html">
 <span class="dropdown-text">Python vs.&nbsp;R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/08/simulations.html">
 <span class="dropdown-text">Lab 8</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-how-tos" role="button" data-bs-toggle="dropdown" aria-expanded="false">How tos</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-how-tos">    
        <li>
    <a class="dropdown-item" href="../howtos/RandRStudioInstall.html">
 <span class="dropdown-text">Installing R &amp; RStudio</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/accessingPython.html">
 <span class="dropdown-text">Accessing Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/accessingUnixCommandLine.html">
 <span class="dropdown-text">Accessing the Unix Command Line</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/gitInstall.html">
 <span class="dropdown-text">Installing Git</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/ps-submission.html">
 <span class="dropdown-text">Problem Set Submissions</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Windows</li>
        <li>
    <a class="dropdown-item" href="../howtos/windowsAndLinux.html">
 <span class="dropdown-text">Installing the Linux Subsystem on Windows</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/windowsInstall.html">
 <span class="dropdown-text">Using R, RStudio, and LaTeX on Windows</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://edstem.org/us/courses/25090/discussion/">Discussion</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://statistics.berkeley.edu/computing/training/tutorials">Tutorials</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/berkeley-stat243/stat243-fall-2022"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Problem Set 7</h1>
<p class="subtitle lead">Due Tuesday Nov.&nbsp;15, 10 am</p>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="comments" class="level2">
<h2 class="anchored" data-anchor-id="comments">Comments</h2>
<ul>
<li>This covers Unit 10.</li>
<li>It’s due at 10 am (Pacific) on Tuesday (yes, Tuesday) November 15, both submitted as a PDF to Gradescope as well as committed to your GitHub repository.</li>
<li>Please see PS1 and the grading rubric for formatting and attribution requirements.</li>
</ul>
</section>
<section id="problems" class="level2">
<h2 class="anchored" data-anchor-id="problems">Problems</h2>
<ol type="1">
<li><p>Suppose I need to compute the generalized least squares estimator, <span class="math inline">\(\hat{\beta}=(X^{\top}\Sigma^{-1}X)^{-1}X^{\top}\Sigma^{-1}Y\)</span>, where <span class="math inline">\(X\)</span> is <span class="math inline">\(n\times p\)</span> and <span class="math inline">\(\Sigma\)</span> is a positive definite <span class="math inline">\(n\times n\)</span> matrix. Assume that <span class="math inline">\(n&gt;p\)</span> and <span class="math inline">\(n\)</span> could be of order several thousand and <span class="math inline">\(p\)</span> of order in the hundreds. First write out in pseudo-code how you would do this in an efficient way - i.e., the particular linear algebra steps and the order of operations. Then write efficient R code in the form of a function, <code>gls()</code>, to do this - you can rely on the various high-level functions for matrix decompositions and solving systems of equations, but you should not use any code that already exists for doing generalized least squares.</p></li>
<li><p>We’ve seen how to use Gaussian elimination (i.e., the LU decomposition) to solve <span class="math inline">\(Ax=b\)</span> and that we can do the solution in <span class="math inline">\(n^{3}/3\)</span> operations (plus lower-order terms). Suppose I want to know how inefficient it is to explicitly invert the matrix <span class="math inline">\(A\)</span> and then multiply, thereby finding <span class="math inline">\(x=A^{-1}b\)</span> via matrix-vector multiplication. If we look at R’s <code>solve.default()</code>, we see it solves the system <span class="math inline">\(AZ=I\)</span> to find <span class="math inline">\(Z=A^{-1}\)</span>. Next note that <code>help(solve)</code> indicates it calls a Lapack routine <a href="http://www.netlib.org/lapack/explore-html/d7/d3b/group__double_g_esolve_ga5ee879032a8365897c3ba91e3dc8d512.html">DGESV</a>, which uses the LU decomposition. Count the number of computations for</p>
<ol type="a">
<li>transforming <span class="math inline">\(AZ=I\)</span> to <span class="math inline">\(UZ=I^{*}\)</span> (where <span class="math inline">\(I^{*}\)</span> is no longer a diagonal matrix),</li>
<li>for solving for <span class="math inline">\(Z\)</span> given <span class="math inline">\(UZ=I^{*}\)</span>, and</li>
<li>for calculating <span class="math inline">\(x=Zb\)</span>.</li>
</ol>
<p>Then compare the total cost to the <span class="math inline">\(n^{3}/3\)</span> cost of what we saw in class.</p>
<p>Notes:</p>
<ul>
<li>In counting the computations you should be able to make use of various results we derived in class concerning the Gaussian elimination computations and computations involved in a backsolve, so your answer should be able to simply combine together results we’ve already discussed without any detailed new derivation.</li>
<li>Given that R’s call to <code>dgesv</code> doesn’t take account of the special (diagonal) structure of <span class="math inline">\(I\)</span> on the right-hand side, you do not need to take account of the fact that because <span class="math inline">\(I\)</span> has zeroes and ones, one can actually save some computation. You can simply count the calculations as if <span class="math inline">\(I\)</span> were filled with arbitrary values. (Note: if we did actually try to be careful about making use of the structure of <span class="math inline">\(I\)</span>, it turns out we could save <span class="math inline">\(n^{3}/3\)</span> calculations.)</li>
</ul></li>
<li><p>Two-stage least squares (2SLS) is a way of implementing a causal inference method called instrumental variables that is commonly used in economics. Consider the following set of regression equations: <span class="math display">\[\begin{aligned}
\hat{X} &amp; = &amp; Z(Z^{\top}Z)^{-1}Z^{\top}X\\
\hat{\beta} &amp; = &amp; (\hat{X}^{\top}\hat{X})^{-1}\hat{X}^{\top}y\end{aligned}\]</span> which can be interpreted as regressing <span class="math inline">\(y\)</span> on <span class="math inline">\(X\)</span> after filtering such that we only retain variation in <span class="math inline">\(X\)</span> that is correlated with the instrumental variable <span class="math inline">\(Z\)</span>. An economics graduate student asked how he could compute <span class="math inline">\(\hat{\beta}\)</span> if <span class="math inline">\(Z\)</span> is 60 million by 630, <span class="math inline">\(X\)</span> is 60 million by 600, and <span class="math inline">\(y\)</span> is <span class="math inline">\(60\)</span> million by 1, but both <span class="math inline">\(Z\)</span> and <span class="math inline">\(X\)</span> are sparse matrices.</p>
<ol type="a">
<li><p>Describe briefly why I can’t do this calculation in two steps as given in the equations, even if I use the techniques for OLS discussed in class for each stage.</p></li>
<li><p>Figure out how to rewrite the equations such that you can actually calculate <span class="math inline">\(\hat{\beta}\)</span> on a computer without a huge amount of memory. You can assume that any matrix multiplications involving sparse matrices can be done on the computer (e.g., using the <em>spam</em> package in R). Describe the specific steps of how you would do this and/or write out in pseudo-code.</p></li>
</ol>
<p>Notes:</p>
<ul>
<li>The product of two sparse matrices is not (in general) sparse and would not be sparse in this case.</li>
<li>As discussed in Section 6 of Unit 10, there are R packages (and software packages more generally) for efficiently storing (to save memory) and efficiently doing matrix manipulations (to save computation time) with sparse matrices.</li>
</ul></li>
<li><p>(Extra credit) In class we saw that the condition number when solving a system of equations, <span class="math inline">\(Ax=b\)</span>, is the ratio of the absolute values of the largest and smallest magnitude eigenvalues of <span class="math inline">\(A\)</span>. Show that <span class="math inline">\(\|A\|_{2}\)</span> (i.e., the matrix norm induced by the usual L2 vector norm; see Section 1 of Unit 10) is the largest of the absolute values of the eigenvalues of <span class="math inline">\(A\)</span> for symmetric <span class="math inline">\(A\)</span>. To do so, find the following quantity, <span class="math display">\[\|A\|_{2}=\sup_{z:\|z\|_{2}=1}\sqrt{(Az)^{\top}Az}.\]</span> If you’re not familiar with the notion of the supremum (the <em>sup</em> here), just think of it as the maximum. It accounts for situations such as trying to find the maximum of the numbers in the open interval (0,1). The max is undefined in this case since there is always a number closer to 1 than any number you choose, but the <em>sup</em> in this case is 1.</p>
<p>Hints: when you get to having the quantity <span class="math inline">\(\Gamma^{\top}z\)</span> for orthogonal <span class="math inline">\(\Gamma\)</span>, set <span class="math inline">\(y=\Gamma^{\top}z\)</span> and show that if <span class="math inline">\(\|z\|_{2}=1\)</span> then <span class="math inline">\(\|y\|_{2}=1\)</span>. Finally, if you have the quantity <span class="math inline">\(y^{\top}Dy\)</span>, think about how this can be rewritten given the form of <span class="math inline">\(D\)</span> and think intuitively about how to maximize it if <span class="math inline">\(\|y\|_{2}=1\)</span>.</p></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>