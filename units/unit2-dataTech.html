<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Chris Paciorek">
<meta name="dcterms.date" content="2022-08-23">

<title>Statistics 243 Fall 2022 - Data technologies, formats, and structures</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../units/unit3-bash.html" rel="next">
<link href="../units/unit1-intro.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Statistics 243 Fall 2022</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html">Syllabus</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../office_hours.html">Office hours</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html">Schedule</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-units" role="button" data-bs-toggle="dropdown" aria-expanded="false">Units</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-units">    
        <li>
    <a class="dropdown-item" href="../units/unit1-intro.html">
 <span class="dropdown-text">Unit 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit2-dataTech.html">
 <span class="dropdown-text">Unit 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit3-bash.html">
 <span class="dropdown-text">Unit 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit4-goodPractices.html">
 <span class="dropdown-text">Unit 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit5-programming.html">
 <span class="dropdown-text">Unit 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="button" data-bs-toggle="dropdown" aria-expanded="false">Labs</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="../labs/01/intro_git_knitr.html">
 <span class="dropdown-text">Lab 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/02/assertionsAndTesting.html">
 <span class="dropdown-text">Lab 2</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-how-tos" role="button" data-bs-toggle="dropdown" aria-expanded="false">How tos</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-how-tos">    
        <li>
    <a class="dropdown-item" href="../howtos/RandRStudioInstall.html">
 <span class="dropdown-text">Installing R &amp; RStudio</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/accessingPython.html">
 <span class="dropdown-text">Accessing Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/accessingUnixCommandLine.html">
 <span class="dropdown-text">Accessing the Unix Command Line</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/gitInstall.html">
 <span class="dropdown-text">Installing Git</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/ps-submission.html">
 <span class="dropdown-text">Problem Set Submissions</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Windows</li>
        <li>
    <a class="dropdown-item" href="../howtos/windowsAndLinux.html">
 <span class="dropdown-text">Installing the Linux Subsystem on Windows</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/windowsInstall.html">
 <span class="dropdown-text">Using R, RStudio, and LaTeX on Windows</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://edstem.org/us/courses/25090/discussion/">Discussion</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://statistics.berkeley.edu/computing/training/tutorials">Tutorials</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Data technologies, formats, and structures</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit1-intro.html" class="sidebar-item-text sidebar-link">Unit 1</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit2-dataTech.html" class="sidebar-item-text sidebar-link active">Unit 2</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit3-bash.html" class="sidebar-item-text sidebar-link">Unit 3</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit4-goodPractices.html" class="sidebar-item-text sidebar-link">Unit 4</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit5-programming.html" class="sidebar-item-text sidebar-link">Unit 5</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-storage-and-file-formats-on-a-computer" id="toc-data-storage-and-file-formats-on-a-computer" class="nav-link active" data-scroll-target="#data-storage-and-file-formats-on-a-computer">1. Data storage and file formats on a computer</a>
  <ul class="collapse">
  <li><a href="#text-and-binary-files" id="toc-text-and-binary-files" class="nav-link" data-scroll-target="#text-and-binary-files">Text and binary files</a></li>
  <li><a href="#common-file-types" id="toc-common-file-types" class="nav-link" data-scroll-target="#common-file-types">Common file types</a></li>
  </ul></li>
  <li><a href="#reading-data-from-text-files-into-r" id="toc-reading-data-from-text-files-into-r" class="nav-link" data-scroll-target="#reading-data-from-text-files-into-r">2. Reading data from text files into R</a>
  <ul class="collapse">
  <li><a href="#core-r-functions" id="toc-core-r-functions" class="nav-link" data-scroll-target="#core-r-functions">Core R functions</a></li>
  <li><a href="#connections" id="toc-connections" class="nav-link" data-scroll-target="#connections">Connections</a></li>
  <li><a href="#file-paths" id="toc-file-paths" class="nav-link" data-scroll-target="#file-paths">File paths</a></li>
  <li><a href="#the-readr-package" id="toc-the-readr-package" class="nav-link" data-scroll-target="#the-readr-package">The <em>readr</em> package</a></li>
  <li><a href="#reading-data-quickly" id="toc-reading-data-quickly" class="nav-link" data-scroll-target="#reading-data-quickly">Reading data quickly</a></li>
  </ul></li>
  <li><a href="#output-from-r" id="toc-output-from-r" class="nav-link" data-scroll-target="#output-from-r">3. Output from R</a>
  <ul class="collapse">
  <li><a href="#writing-output-to-files" id="toc-writing-output-to-files" class="nav-link" data-scroll-target="#writing-output-to-files">Writing output to files</a></li>
  <li><a href="#formatting-output" id="toc-formatting-output" class="nav-link" data-scroll-target="#formatting-output">Formatting output</a></li>
  </ul></li>
  <li><a href="#webscraping-and-working-with-html-xml-and-json" id="toc-webscraping-and-working-with-html-xml-and-json" class="nav-link" data-scroll-target="#webscraping-and-working-with-html-xml-and-json">4. Webscraping and working with HTML, XML, and JSON</a>
  <ul class="collapse">
  <li><a href="#reading-html" id="toc-reading-html" class="nav-link" data-scroll-target="#reading-html">Reading HTML</a></li>
  <li><a href="#xml" id="toc-xml" class="nav-link" data-scroll-target="#xml">XML</a></li>
  <li><a href="#json" id="toc-json" class="nav-link" data-scroll-target="#json">JSON</a></li>
  <li><a href="#webscraping-and-web-apis" id="toc-webscraping-and-web-apis" class="nav-link" data-scroll-target="#webscraping-and-web-apis">Webscraping and web APIs</a>
  <ul class="collapse">
  <li><a href="#webscraping-ethics-and-best-practices" id="toc-webscraping-ethics-and-best-practices" class="nav-link" data-scroll-target="#webscraping-ethics-and-best-practices">Webscraping ethics and best practices</a></li>
  <li><a href="#what-is-http" id="toc-what-is-http" class="nav-link" data-scroll-target="#what-is-http">What is HTTP?</a></li>
  <li><a href="#apis-rest--and-soap-based-web-services" id="toc-apis-rest--and-soap-based-web-services" class="nav-link" data-scroll-target="#apis-rest--and-soap-based-web-services">APIs: REST- and SOAP-based web services</a></li>
  <li><a href="#http-requests-by-deconstructing-an-undocumented-api" id="toc-http-requests-by-deconstructing-an-undocumented-api" class="nav-link" data-scroll-target="#http-requests-by-deconstructing-an-undocumented-api">HTTP requests by deconstructing an (undocumented) API</a></li>
  <li><a href="#more-details-on-http-requests" id="toc-more-details-on-http-requests" class="nav-link" data-scroll-target="#more-details-on-http-requests">More details on HTTP requests</a></li>
  <li><a href="#packaged-access-to-an-api" id="toc-packaged-access-to-an-api" class="nav-link" data-scroll-target="#packaged-access-to-an-api">Packaged access to an API</a></li>
  <li><a href="#accessing-dynamic-pages" id="toc-accessing-dynamic-pages" class="nav-link" data-scroll-target="#accessing-dynamic-pages">Accessing dynamic pages</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#file-and-string-encodings" id="toc-file-and-string-encodings" class="nav-link" data-scroll-target="#file-and-string-encodings">5. File and string encodings</a></li>
  <li><a href="#data-structures" id="toc-data-structures" class="nav-link" data-scroll-target="#data-structures">6. Data structures</a>
  <ul class="collapse">
  <li><a href="#standard-data-structures-in-r-and-python" id="toc-standard-data-structures-in-r-and-python" class="nav-link" data-scroll-target="#standard-data-structures-in-r-and-python">Standard data structures in R and Python</a></li>
  <li><a href="#other-kinds-of-data-structures" id="toc-other-kinds-of-data-structures" class="nav-link" data-scroll-target="#other-kinds-of-data-structures">Other kinds of data structures</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Data technologies, formats, and structures</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Chris Paciorek </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 23, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<p><a href="./unit2-dataTech.pdf" class="btn btn-primary">PDF</a></p>
<p>References (see <a href="../syllabus">syllabus</a> for links):</p>
<ul>
<li>Adler</li>
<li>Nolan and Temple Lang, XML and Web Technologies for Data Sciences with R.</li>
<li>Chambers</li>
<li><a href="http://cran.r-project.org/doc/manuals/R-intro.html">R intro manual</a> on CRAN (R-intro).</li>
<li>Venables and Ripley, Modern Applied Statistics with S</li>
<li>Murrell, Introduction to Data Technologies.</li>
<li><a href="http://cran.r-project.org/doc/manuals/R-data.html">R Data Import/Export manual</a> on CRAN (R-data).</li>
<li>SCF tutorial: <a href="https://berkeley-scf.github.io/tutorial-databases/">Working with large datasets in SQL, R, and Python</a></li>
</ul>
<p>(Optional) Videos</p>
<p>There are four videos from 2020 in the bCourses Media Gallery that you can use for reference if you want to:</p>
<ol type="1">
<li>Text files and ASCII</li>
<li>Encodings and UTF-8</li>
<li>HTML</li>
<li>XML and JSON</li>
</ol>
<section id="data-storage-and-file-formats-on-a-computer" class="level1">
<h1>1. Data storage and file formats on a computer</h1>
<p>We’re going to start early in the data analysis pipeline: getting data, reading data in, writing data out to disk, and webscraping. We’ll focus on doing these manipulations in R, but the concepts and tools involved are common to other languages, so familarity with these in R should allow you to pick up other tools easily. The main downside to working with datasets in R (true for Python and most other languages as well) is that the entire dataset resides in memory, so R is not so good for dealing with very large datasets. More on alternatives in a later unit. R (and similar languages) has the capability to read in a wide variety of file formats.</p>
<section id="text-and-binary-files" class="level2">
<h2 class="anchored" data-anchor-id="text-and-binary-files">Text and binary files</h2>
<p>In general, files can be divided into text files and binary files. In both cases, information is stored as a series of bits. Recall that a bit is a single value in base 2 (i.e., a 0 or a 1), while a byte is 8 bits.</p>
<p>A <strong>text file</strong> is one in which the bits in the file encode individual characters. Note that the characters can include the digit characters 0-9, so one can include numbers in a text file by writing down the digits needed for the number of interest. Examples of text file formats include CSV, XML, HTML, and JSON.</p>
<p>Text files may be simple ASCII files (i.e., files encoded using ASCII) or in other encodings such as UTF-8, both covered in Section 5. <a href="http://en.wikipedia.org/wiki/ASCII">ASCII</a> files have 8 bits (1 byte) per character and can represent 128 characters (the 52 lower and upper case letters in English, 10 digits, punctuation and a few other things – basically what you see on a standard US keyboard). UTF-8 files have between 1 and 4 bytes per character.</p>
<p>A <strong>binary file</strong> is one in which the bits in the file encode the information in a custom format and not simply individual characters. Binary formats are not (easily) human readable but can be more space-efficient and faster to work with (because it can allow random access into the data rather than requiring sequential reading). The meaning of the bytes in such files depends on the specific binary format being used and a program that uses the file needs to know how the format represents information. Examples of binary files include netCDF files, R data (e.g., .Rda) files, Python pickle files, and compiled code files.</p>
<p>Numbers in binary files are usually stored as 8 bytes per number. We’ll discuss this much more in Unit 8.</p>
</section>
<section id="common-file-types" class="level2">
<h2 class="anchored" data-anchor-id="common-file-types">Common file types</h2>
<p>Here are some of the common file types, some of which are text formats and some of which are binary formats.</p>
<ol type="1">
<li><p>‘Flat’ text files: data are often provided as simple text files. Often one has one record or observation per row and each column or field is a different variable or type of information about the record. Such files can either have a fixed number of characters in each field (<em>fixed width format</em>) or a special character (a <em>delimiter</em>) that separates the fields in each row. Common delimiters are tabs, commas, one or more spaces, and the pipe (|). Common file extensions are <em>.txt</em> and <em>.csv</em>. Metadata (information about the data) are often stored in a separate file. CSV files are quite common, but if you have files where the data contain commas, other delimiters can be good. Text can be put in quotes in CSV files, and this can allow use of commas within the data. This is difficult to deal with from the command line, but <em>read.table()</em> in R handles this situation.</p>
<ul>
<li>One occasionally tricky difficulty is as follows. If you have a text file created in Windows, the line endings are coded differently than in UNIX. Windows uses a newline (the ASCII character <code>\n</code>) and a carriage return (the ASCII character <code>\r</code>) whereas UNIX uses onlyl a newline in UNIX). There are UNIX utilities (<code>fromdos</code> in Ubuntu, including the SCF Linux machines and <code>dos2unix</code> in other Linux distributions) that can do the necessary conversion. If you see <em>^M</em> at the end of the lines in a file, that’s the tool you need. Alternatively, if you open a UNIX file in Windows, it may treat all the lines as a single line. You can fix this with <code>todos</code> or <code>unix2dos</code>.</li>
</ul></li>
<li><p>In some contexts, such as textual data and bioinformatics data, the data may be in a text file with one piece of information per row, but without meaningful columns/fields.</p></li>
<li><p>In scientific contexts, netCDF (<em>.nc</em>) (and the related HDF5) are popular format for gridded data that allows for highly-efficient storage and contains the metadata within the file. The basic structure of a netCDF file is that each variable is an array with multiple dimensions (e.g., latitude, longitude, and time), and one can also extract the values of and metadata about each dimension. The <em>ncdf4</em> package in R nicely handles working with netCDF files.</p></li>
<li><p>Data may also be in text files in formats designed for data interchange between various languages, in particular XML or JSON. These formats are “self-describing”; namely the metadata is part of the file. The <em>XML2, rvest</em>, and <em>jsonlite</em> packages are useful for reading and writing from these formats. More in Section 4.</p></li>
<li><p>You may be scraping information on the web, so dealing with text files in various formats, including HTML. The <em>XML2</em> and <em>rvest</em> packages are also useful for reading HTML.</p></li>
<li><p>Data may already be in a database or in the data storage format of another statistical package (<em>Stata</em>, <em>SAS</em>, <em>SPSS</em>, etc.). The <em>foreign</em> package in R has excellent capabilities for importing Stata (<em>read.dta()</em>), SPSS (<em>read.spss()</em>), and SAS (<em>read.ssd()</em> and, for XPORT files, <em>read.xport()</em>), among others.</p></li>
<li><p>For Excel, there are capabilities to read an Excel file (see the <em>readxl</em> and <em>XLConnect</em> package among others), but you can also just go into Excel and export as a CSV file or the like and then read that into R. In general, it’s best not to pass around data files as Excel or other spreadsheet format files because (1) Excel is proprietary, so someone may not have Excel and the format is subject to change, (2) Excel imposes limits on the number of rows, (3) one can easily manipulate text files such as CSV using UNIX tools, but this is not possible with an Excel file, (4) Excel files often have more than one sheet, graphs, macros, etc., so they’re not a data storage format per se.</p></li>
<li><p>R can easily interact with databases (SQLite, PostgreSQL, MySQL, Oracle, etc.), querying the database using SQL and returning results to R. More in the big data unit and in the large datasets tutorial mentioned above.</p></li>
</ol>
</section>
</section>
<section id="reading-data-from-text-files-into-r" class="level1">
<h1>2. Reading data from text files into R</h1>
<section id="core-r-functions" class="level2">
<h2 class="anchored" data-anchor-id="core-r-functions">Core R functions</h2>
<p><em>read.table()</em> is probably the most commonly-used function for reading in data. It reads in delimited files (<em>read.csv()</em> and <em>read.delim()</em> are special cases of <em>read.table()</em>). The key arguments are the delimiter (the <em>sep</em> argument) and whether the file contains a header, a line with the variable names. We can use <em>read.fwf()</em> to read from a fixed width text file into a data frame.</p>
<p>The most difficult part of reading in such files can be dealing with how R determines the classes of the fields that are read in. There are a number of arguments to <em>read.table()</em> and <em>read.fwf()</em> that allow the user to control the classes. One difficulty in older versions of R was that character fields were read in as factors.</p>
<p>Let’s work through a couple examples. Before we do that, let’s look at the arguments to <em>read.table()</em>. Note that <code>sep=''</code> separates on any amount of white space.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.path</span>(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'RTADataSub.csv'</span>),</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sep =</span> <span class="st">','</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(dat, class)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]  <span class="co"># What are the classes of the columns?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>X2010.08.02.18.55             X2336              X549             X2086 
      "character"       "character"       "character"       "character" 
             X666              X481              X298             X1624 
      "character"       "character"       "character"       "character" 
            X1732              X593 
      "character"       "character" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## whoops, there is an 'x', presumably indicating missingness:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(dat[ , <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "2124" "1830" "1833" "1600" "1578" "1187" "1005" "918"  "865"  "871" 
 [11] "860"  "883"  "897"  "898"  "893"  "913"  "870"  "962"  "880"  "875" 
 [21] "884"  "894"  "836"  "848"  "885"  "851"  "900"  "861"  "866"  "867" 
 [31] "829"  "853"  "920"  "877"  "908"  "855"  "845"  "859"  "856"  "825" 
 [41] "828"  "854"  "847"  "840"  "873"  "822"  "818"  "838"  "815"  "813" 
 [51] "816"  "849"  "802"  "805"  "792"  "823"  "808"  "798"  "800"  "842" 
 [61] "809"  "807"  "826"  "810"  "801"  "794"  "771"  "796"  "790"  "787" 
 [71] "775"  "751"  "783"  "811"  "768"  "779"  "795"  "770"  "821"  "830" 
 [81] "767"  "772"  "791"  "781"  "773"  "777"  "814"  "778"  "782"  "837" 
 [91] "759"  "846"  "797"  "835"  "832"  "793"  "803"  "834"  "785"  "831" 
[101] "820"  "812"  "824"  "728"  "760"  "762"  "753"  "758"  "764"  "741" 
[111] "709"  "735"  "749"  "752"  "761"  "750"  "776"  "766"  "789"  "763" 
[121] "864"  "858"  "869"  "886"  "844"  "863"  "916"  "890"  "872"  "907" 
[131] "926"  "935"  "933"  "906"  "905"  "912"  "972"  "996"  "1009" "961" 
[141] "952"  "981"  "917"  "1011" "1071" "1920" "3245" "3805" "3926" "3284"
[151] "2700" "2347" "2078" "2935" "3040" "1860" "1437" "1512" "1720" "1493"
[161] "1026" "928"  "874"  "833"  "850"  ""     "x"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## let's treat 'x' as a missing value indicator</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.path</span>(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'RTADataSub.csv'</span>),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sep =</span> <span class="st">','</span>, <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">"NA"</span>, <span class="st">"x"</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(dat2[ , <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 2124 1830 1833 1600 1578 1187 1005  918  865  871  860  883  897  898  893
 [16]  913  870  962  880  875  884  894  836  848  885  851  900  861  866  867
 [31]  829  853  920  877  908  855  845  859  856  825  828  854  847  840  873
 [46]  822  818  838  815  813  816  849  802  805  792  823  808  798  800  842
 [61]  809  807  826  810  801  794  771  796  790  787  775  751  783  811  768
 [76]  779  795  770  821  830  767  772  791  781  773  777  814  778  782  837
 [91]  759  846  797  835  832  793  803  834  785  831  820  812  824  728  760
[106]  762  753  758  764  741  709  735  749  752  761  750  776  766  789  763
[121]  864  858  869  886  844  863  916  890  872  907  926  935  933  906  905
[136]  912  972  996 1009  961  952  981  917 1011 1071 1920 3245 3805 3926 3284
[151] 2700 2347 2078 2935 3040 1860 1437 1512 1720 1493 1026  928  874  833  850
[166]   NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's check that the empty strings from 'dat' are now NAs in 'dat2'</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(dat[ , <span class="dv">2</span>] <span class="sc">==</span> <span class="st">""</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 312 313 314 315 317 318 319 320 322 323</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dat2[<span class="fu">which</span>(dat[, <span class="dv">2</span>] <span class="sc">==</span> <span class="st">""</span>)[<span class="dv">1</span>], ] <span class="co"># pull out a line with a missing string</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    X2010.08.02.18.55 X2336 X549 X2086 X666 X481 X298 X1624 X1732 X593 X222
312  2010-08-03 10:31    NA   NA    NA   NA   NA   NA    NA    NA   NA   NA
    X911 X261 X1730 X211 X365 X216 X438 X596 X206 X204 X270 X176 X1159 X1137
312   NA   NA    NA   NA   NA   NA   NA   NA   NA   NA   NA   NA    NA    NA
    X135 X2036 X138 X1038 X201 X610 X627 X195 X976 X151 X1830 X421 X1087 X1157
312   NA    NA   NA    NA   NA   NA   NA   NA   NA   NA    NA   NA    NA    NA
    X181 X267 X193 X391 X208 X614 X546 X186 X1391 X217 X230 X625 X376 X164 X329
312   NA   NA   NA   NA   NA   NA   NA   NA    NA   NA   NA   NA   NA   NA   NA
    X1043 X497 X440 X197 X287 X837 X226 X973
312    NA   NA   NA   NA   NA   NA   NA   NA</code></pre>
</div>
</div>
<p>Using <code>colClasses</code> is a good way to control how data are read in.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sequ <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.path</span>(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'hivSequ.csv'</span>),</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">','</span>, <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">colClasses =</span> <span class="fu">c</span>(<span class="st">'integer'</span>,<span class="st">'integer'</span>,<span class="st">'character'</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'character'</span>,<span class="st">'numeric'</span>,<span class="st">'integer'</span>))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="do">## let's make sure the coercion worked - sometimes R is obstinant</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(sequ, class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  PatientID        Resp      PR.Seq      RT.Seq       VL.t0      CD4.t0 
  "integer"   "integer" "character" "character"   "numeric"   "integer" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## that made use of the fact that a data frame is a list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that you can avoid reading in one or more columns by specifying <em>NULL</em> as the column class for those columns to be omitted. Also, specifying the <em>colClasses</em> argument explicitly should make for faster file reading. Finally, setting <code>stringsAsFactors=FALSE</code> is standard practice and is the default in R as of version 4.0. (<em>readr::read_csv()</em> has always set <code>stringsAsFactors=FALSE</code>).</p>
<p>If possible, it’s a good idea to look through the input file in the shell or in an editor before reading into R to catch such issues in advance. Using the UNIX command <em>less</em> on <em>RTADataSub.csv</em> would have revealed these various issues, but note that <em>RTADataSub.csv</em> is a 1000-line subset of a much larger file of data available from the kaggle.com website. So more sophisticated use of UNIX utilities (as we will see in Unit 3) is often useful before trying to read something into a program.</p>
<p>The basic function <em>scan()</em> simply reads everything in, ignoring lines, which works well and very quickly if you are reading in a numeric vector or matrix. <em>scan()</em> is also useful if your file is free format - i.e., if it’s not one line per observation, but just all the data one value after another; in this case you can use <em>scan()</em> to read it in and then format the resulting character or numeric vector as a matrix with as many columns as fields in the dataset. Remember that the default is to fill the matrix by column.</p>
<p>If the file is not nicely arranged by field (e.g., if it has ragged lines), we’ll need to do some more work. <em>readLines()</em> will read in each line into a separate character vector, after which we can process the lines using text manipulation. Here’s an example from some US meteorological data where I know from metadata (not provided here) that the 4-11th values are an identifier, the 17-20th are the year, the 22-23rd the month, etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="fu">file.path</span>(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'precip.txt'</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">substring</span>(dat, <span class="dv">4</span>, <span class="dv">11</span>) )</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">substring</span>(dat, <span class="dv">18</span>, <span class="dv">21</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>year[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2010" "2010" "2010" "2010" "2010"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">substring</span>(dat, <span class="dv">18</span>, <span class="dv">21</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>month <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">substring</span>(dat, <span class="dv">22</span>, <span class="dv">23</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>nvalues <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">substring</span>(dat, <span class="dv">28</span>, <span class="dv">30</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Actually, that file, <em>precip.txt</em>, is in a fixed-width format (i.e., every element in a given column has the exact same number of characters),so reading in using <em>read.fwf()</em> would be a good strategy.</p>
</section>
<section id="connections" class="level2">
<h2 class="anchored" data-anchor-id="connections">Connections</h2>
<p>R allows you to read in not just from a file but from a more general construct called a <em>connection</em>. This can include reading in text from the output of running a shell command and from unzipping a file on the fly.</p>
<p>Here are some examples of connections:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="fu">pipe</span>(<span class="st">"ls -al"</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">pipe</span>(<span class="st">"unzip dat.zip"</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">gzfile</span>(<span class="st">"dat.csv.gz"</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"http://www.stat.berkeley.edu/~paciorek/index.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In some cases, you might need to create the connection using <em>url()</em> or using the <em>curl()</em> function from the <em>curl</em> package. Though for the example here, simply passing the URL to <em>readLines()</em> does work. (In general, <em>curl::curl()</em> provides some nice features for reading off the internet.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>wikip1 <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"https://wikipedia.org"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>wikip2 <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="fu">url</span>(<span class="st">"https://wikipedia.org"</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(curl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using libcurl 7.68.0 with GnuTLS/3.6.13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>wikip3 <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="fu">curl</span>(<span class="st">"https://wikipedia.org"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If a file is large, we may want to read it in in chunks (of lines), do some computations to reduce the size of things, and iterate. This is referred to as online processing. <em>read.table()</em>, <em>read.fwf()</em> and <em>readLines()</em> all have the arguments that let you read in a fixed number of lines. To read-on-the-fly in blocks, we need to first establish the connection and then read from it sequentially. (If you don’t, you’ll read from the start of the file every time you read from the file.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">file</span>(<span class="fu">file.path</span>(<span class="st">".."</span>, <span class="st">"data"</span>, <span class="st">"precip.txt"</span>), <span class="st">"r"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="do">## "r" for 'read' - you can also open files for writing with "w"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="do">## (or "a" for appending)</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(con)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>blockSize <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co"># obviously this would be large in any real application</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>nLines <span class="ot">&lt;-</span> <span class="dv">300000</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ceiling</span>(nLines <span class="sc">/</span> blockSize)){</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    lines <span class="ot">&lt;-</span> <span class="fu">readLines</span>(con, <span class="at">n =</span> blockSize)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># manipulate the lines and store the key stuff</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">close</span>(con)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>&nbsp;</p>
<p>Here’s an example of using <em>curl()</em> to do this for a file on the web.</p>
<div class="cell" data-hash="unit2-dataTech_cache/html/stream-curl_204437a3b1e11a60237f8fdf90bf612f">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>URL <span class="ot">&lt;-</span> <span class="st">"https://www.stat.berkeley.edu/share/paciorek/2008.csv.gz"</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">gzcon</span>(<span class="fu">curl</span>(URL, <span class="at">open =</span> <span class="st">"r"</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="do">## url() in place of curl() works too</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {   <span class="do">## Read in first four chunks as an example</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(i)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">system.time</span>(tmp <span class="ot">&lt;-</span> <span class="fu">readLines</span>(con, <span class="at">n =</span> <span class="dv">100000</span>)))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(tmp[<span class="dv">1</span>])</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
   user  system elapsed 
  0.467   0.005   0.472 
[1] "Year,Month,DayofMonth,DayOfWeek,DepTime,CRSDepTime,ArrTime,CRSArrTime,UniqueCarrier,FlightNum,TailNum,ActualElapsedTime,CRSElapsedTime,AirTime,ArrDelay,DepDelay,Origin,Dest,Distance,TaxiIn,TaxiOut,Cancelled,CancellationCode,Diverted,CarrierDelay,WeatherDelay,NASDelay,SecurityDelay,LateAircraftDelay"
[1] 2
   user  system elapsed 
  0.424   0.008   0.433 
[1] "2008,1,29,2,1938,1935,2308,2257,XE,7676,N11176,150,142,104,11,3,SLC,OKC,866,5,41,0,,0,NA,NA,NA,NA,NA"
[1] 3
   user  system elapsed 
  0.422   0.005   0.426 
[1] "2008,1,20,7,1540,1525,1651,1637,OO,5703,N227SW,71,72,58,14,15,SBA,SJC,234,5,8,0,,0,NA,NA,NA,NA,NA"
[1] 4
   user  system elapsed 
  0.433   0.009   0.441 
[1] "2008,1,2,3,1313,1250,1443,1425,WN,440,N461WN,150,155,138,18,23,MCO,STL,880,3,9,0,,0,2,0,0,0,16"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">close</span>(con)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>More details on sequential (on-line) processing of large files can be found in the tutorial on large datasets mentioned in the reference list above.</p>
<p>One cool trick that can come in handy is to create a <em>text connection</em>. This lets you ‘read’ from an R character vector as if it were a text file and could be handy for processing text. For example, you could then use <em>read.fwf()</em> applied to <em>con</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">'../data/precip.txt'</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(dat[<span class="dv">1</span>], <span class="st">"r"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">read.fwf</span>(con, <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">8</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   V1      V2   V3 V4   V5 V6
1 DLY 1000807 PRCP HI 2010  2</code></pre>
</div>
</div>
<p>We can create connections for writing output too. Just make sure to open the connection first.</p>
</section>
<section id="file-paths" class="level2">
<h2 class="anchored" data-anchor-id="file-paths">File paths</h2>
<p>A few notes on file paths, related to ideas of reproducibility.</p>
<ol type="1">
<li><p>In general, you don’t want to hard-code absolute paths into your code files because those absolute paths won’t be available on the machines of anyone you share the code with. Instead, use paths relative to the directory the code file is in, or relative to a baseline directory for the project, e.g.:<br>
</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'../data/cpds.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Be careful with the directory separator in Windows files: you can either do <code>C:\\mydir\\file.txt</code> or <code>C:/mydir/file.txt</code>, but not <code>C:\mydir\file.txt</code>, and note the next comment about avoiding use of ‘\’ for portability.</p></li>
<li><p>Using UNIX style directory separators will work in Windows, Mac or Linux, but using Windows style separators is not portable across operating systems.<br>
</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## good: will work on Windows</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'../data/cpds.csv'</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="do">## bad: won't work on Mac or Linux</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'..</span><span class="sc">\\</span><span class="st">data</span><span class="sc">\\</span><span class="st">cpds.csv'</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Even better, use <em>file.path()</em> so that paths are constructed specifically for the operating system the user is using:<br>
</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## good: operating-system independent</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'cpds.csv'</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ol>
</section>
<section id="the-readr-package" class="level2">
<h2 class="anchored" data-anchor-id="the-readr-package">The <em>readr</em> package</h2>
<p><em>readr</em> is intended to deal with some of the shortcomings of the base R functions, such as leaving column names unmodified, and recognizing dates/times. It reads data in much more quickly than the base R equivalents. See <a href="http://blog.rstudio.org/2015/04/09/readr-0-1-0/">this blog post</a>. Some of the readr functions that are analogs to the comparably-named base R functions are <em>read_csv()</em>, <em>read_fwf()</em>, <em>read_lines()</em>, and <em>read_table()</em>.</p>
<p>Let’s try out <em>read_csv()</em> on the airline dataset used in the R bootcamp.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'readr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:curl':

    parse_date</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">## I'm violating the rule about absolute paths here!!</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="do">## (airline.csv is big enough that I don't want to put it in the</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    course repository)</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="st">"../data"</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(dir, <span class="st">'airline.csv'</span>), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  3.246   0.107   3.356 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(dat2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(dir, <span class="st">'airline.csv'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 539895 Columns: 29</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (5): UniqueCarrier, TailNum, Origin, Dest, CancellationCode
dbl (24): Year, Month, DayOfMonth, DayOfWeek, DepTime, CRSDepTime, ArrTime, ...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  3.895   0.124   1.252 </code></pre>
</div>
</div>
</section>
<section id="reading-data-quickly" class="level2">
<h2 class="anchored" data-anchor-id="reading-data-quickly">Reading data quickly</h2>
<p>In addition to the tips above, there are a number of packages that allow one to read large data files quickly, in particular <em>data.table</em>, <em>arrow</em>, and <em>fst</em>. In general, these provide the ability to load datasets into R without having them in memory, but rather stored in clever ways on disk that allow for fast access. Metadata is stored in R. More on this in the unit on big data and in the tutorial on large datasets mentioned in the reference list above.</p>
</section>
</section>
<section id="output-from-r" class="level1">
<h1>3. Output from R</h1>
<section id="writing-output-to-files" class="level2">
<h2 class="anchored" data-anchor-id="writing-output-to-files">Writing output to files</h2>
<p>Functions for text output are generally analogous to those for input. <em>write.table()</em>, <em>write.csv()</em>, and <em>writeLines()</em> are analogs of <em>read.table()</em>, <em>read.csv()</em>, and <em>readLines()</em>. <em>write_csv()</em> is the <em>readr</em> version of write.csv. <em>write()</em> can be used to write a matrix to a file, specifying the number of columns desired. <em>cat()</em> can be used when you want fine control of the format of what is written out and allows for outputting to a connection (e.g., a file).</p>
<p><em>toJSON()</em> in the <em>jsonlite</em> package will output R objects as JSON. One use of JSON as output from R would be to <em>serialize</em> the information in an R object such that it could be read into another program.</p>
<p>And of course you can always save to an R data file (a binary file format) using <em>save.image()</em> (to save all the objects in the workspace or <em>save()</em> to save only some objects. Happily this is platform-independent so can be used to transfer R objects between different OS.</p>
</section>
<section id="formatting-output" class="level2">
<h2 class="anchored" data-anchor-id="formatting-output">Formatting output</h2>
<p><em>cat()</em> is a good choice for printing a message to the screen, often better than <em>print()</em>, which is an object-oriented method. You generally won’t have control over how the output of a <em>print()</em> statement is actually printed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>val <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'My value is '</span>, val, <span class="st">'.</span><span class="sc">\n</span><span class="st">'</span>, <span class="at">sep =</span> <span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>My value is 1.5.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">'My value is '</span>, val, <span class="st">'.'</span>, <span class="at">sep =</span> <span class="st">''</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "My value is 1.5."</code></pre>
</div>
</div>
<p>We can do more to control formatting with <em>cat()</em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">## input</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="do">## display powers</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Powers of"</span>, x, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Powers of 7 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"exponent   result</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>exponent   result</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> result <span class="sc">*</span> x</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">format</span>(i, <span class="at">width =</span> <span class="dv">8</span>), <span class="fu">format</span>(result, <span class="at">width =</span> <span class="dv">10</span>),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1         7
       2        49
       3       343
       4      2401
       5     16807</code></pre>
</div>
</div>
<p>One thing to be aware of when writing out numerical data is how many digits are included. For example, the default with <code>write</code> and <code>cat</code> is the number of digits that R displays to the screen, controlled by <code>options()$digits</code>. But note that <code>options()$digits</code> seems to have some variability in behavior across operating systems. If you want finer control, use <code>sprintf</code>. For example, here we print out temperatures as reals (“f”=floating point) with four decimal places and nine total character positions, followed by a C for Celsius:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>temps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">12.5</span>, <span class="fl">37.234324</span>, <span class="fl">1342434324.79997234</span>, <span class="fl">2.3456e-6</span>, <span class="fl">1e10</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"%9.4f C"</span>, temps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "  12.5000 C"        "  37.2343 C"        "1342434324.8000 C" 
[4] "   0.0000 C"        "10000000000.0000 C"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>city <span class="ot">&lt;-</span> <span class="st">"Boston"</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"The temperature in %s was %.4f C."</span>, city, temps[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The temperature in Boston was 12.5000 C."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"The temperature in %s was %9.4f C."</span>, city, temps[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The temperature in Boston was   12.5000 C."</code></pre>
</div>
</div>
<p>To change the number of digits printed to the screen, do <code>options(digits = 5)</code> or specify as an argument to <code>print</code> or use <code>sprintf</code>.</p>
</section>
</section>
<section id="webscraping-and-working-with-html-xml-and-json" class="level1">
<h1>4. Webscraping and working with HTML, XML, and JSON</h1>
<p>The book <em>XML and Web Technologies for Data Sciences with R</em> by Deb Nolan (UCB Stats faculty) and Duncan Temple Lang (UCB Stats PhD alumnus and UC Davis Stats faculty) provides extensive information about getting and processing data off of the web, including interacting with web services such as REST and SOAP and programmatically handling authentication.</p>
<p>Here are some UNIX command-line tools to help in webscraping and working with files in formats such as JSON, XML, and HTML: <a href="http://jeroenjanssens.com/2013/09/19/seven-command-line-tools-for-data-science.html" class="uri">http://jeroenjanssens.com/2013/09/19/seven-command-line-tools-for-data-science.html</a>.</p>
<p>We’ll cover a few basic examples in this section, but HTML and XML formatting and navigating the structure of such pages in great detail is beyond the scope of what we can cover. The key thing is to see the main concepts and know that the tools exist so that you can learn how to use them if faced with such formats.</p>
<section id="reading-html" class="level2">
<h2 class="anchored" data-anchor-id="reading-html">Reading HTML</h2>
<p>HTML (Hypertext Markup Language) is the standard markup language used for displaying content in a web browser. In simple webpages (ignoring the more complicated pages that involve Javascript), what you see in your browser is simply a <em>rendering</em> (by the browser) of a text file containing HTML.</p>
<p>However, instead of rendering the HTML in a browser, we might want to use code to extract information from the HTML.</p>
<p>Let’s see a brief example of reading in HTML tables.</p>
<p>Note that before doing any coding, it can be helpful to look at the raw HTML source code for a given page. We can explore the underlying HTML source in advance of writing our code by looking at the page source directly in the browser (e.g., in Firefox under the 3-lines “open menu” symbol, see <code>Web Developer (or More Tools) -&gt; Page Source</code> and in Chrome <code>View -&gt; Developer -&gt; View Source</code>), or by downloading the webpage and looking at it in an editor, although in some cases (such as the nytimes.com case), what we might see is a lot of JavaScript.</p>
<p>One lesson here is not to write a lot of your own code to do something that someone else has probably already written a package for. We’ll use the <em>rvest</em> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest, <span class="at">quietly =</span> <span class="cn">TRUE</span>)  <span class="co"># uses xml2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rvest'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:readr':

    guess_encoding</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>URL <span class="ot">&lt;-</span> <span class="st">"https://en.wikipedia.org/wiki/List_of_countries_and_dependencies_by_population"</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(URL)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>tbls <span class="ot">&lt;-</span> <span class="fu">html_table</span>(<span class="fu">html_elements</span>(html, <span class="st">"table"</span>))</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(tbls, nrow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 242  12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> tbls[[<span class="dv">1</span>]]</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  Rank  `Country / Dependency` Conti…¹ Popul…² Perce…³ Date  Sourc…⁴ Notes ``   
  &lt;chr&gt; &lt;chr&gt;                  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;lgl&gt;
1 –     World                  All     7,976,… 100%    6 Se… UN pro… ""    NA   
2 1     China                  Asia    1,412,… 17.7%   31 D… Offici… "The… NA   
3 2     India                  Asia    1,375,… 17.2%   1 Ma… Offici… "The… NA   
4 3     United States          North … 333,06… 4.18%   6 Se… Nation… "The… NA   
5 4     Indonesia              Asia[b] 275,77… 3.46%   1 Ju… Offici… ""    NA   
6 5     Pakistan               Asia    235,82… 2.96%   1 Ju… UN pro… "The… NA   
# … with abbreviated variable names ¹​Continent, ²​Population,
#   ³​`Percentage of the world`, ⁴​`Source (official or from the United Nations)`</code></pre>
</div>
</div>
<p>(Caution here – notice what format the columns are stored in…)</p>
<p><em>read_html()</em> works by reading in the HTML as text and then parsing it to build up a tree containing the HTML elements. Then <em>html_elements()</em> finds the HTML tables and <em>html_table()</em> converts them to data frames. rvest is part of the tidyverse, so it’s often used with piping, e.g.,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Turns out that html_table can take the entire html doc as input</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>tbls <span class="ot">&lt;-</span> URL <span class="sc">|&gt;</span> <span class="fu">read_html</span>() <span class="sc">|&gt;</span> <span class="fu">html_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It’s often useful to be able to extract the hyperlinks in an HTML document. We’ll find the link using <a href="https://www.w3schools.com/cssref/css_selectors.asp">CSS selectors</a>, which allow you to search for elements within HTML:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>URL <span class="ot">&lt;-</span> <span class="st">"http://www1.ncdc.noaa.gov/pub/data/ghcn/daily/by_year"</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="do">## approach 1: search for elements with 'href' attribute</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>links <span class="ot">&lt;-</span> <span class="fu">read_html</span>(URL) <span class="sc">%&gt;%</span> <span class="fu">html_elements</span>(<span class="st">"[href]"</span>) <span class="sc">%&gt;%</span> <span class="fu">html_attr</span>(<span class="st">'href'</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="do">## approach 2: search for HTML 'a' tags</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>links <span class="ot">&lt;-</span> <span class="fu">read_html</span>(URL) <span class="sc">%&gt;%</span> <span class="fu">html_elements</span>(<span class="st">"a"</span>) <span class="sc">%&gt;%</span> <span class="fu">html_attr</span>(<span class="st">'href'</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(links, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "?C=N;O=D"              "?C=M;O=A"              "?C=S;O=A"             
 [4] "?C=D;O=A"              "/pub/data/ghcn/daily/" "1750.csv.gz"          
 [7] "1763.csv.gz"           "1764.csv.gz"           "1765.csv.gz"          
[10] "1766.csv.gz"          </code></pre>
</div>
</div>
<p>More generally, we may want to read an HTML document, parse it into its components (i.e., the HTML elements), and navigate through the tree structure of the HTML. Here we use the <em>XPath</em> language to specify elements rather than CSS selectors. XPath can also be used for navigating through XML documents.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="do">## find all 'a' elements that have attribute 'href'; then</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="do">## extract the 'href' attribute</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>links <span class="ot">&lt;-</span> <span class="fu">read_html</span>(URL) <span class="sc">%&gt;%</span> <span class="fu">html_elements</span>(<span class="at">xpath =</span> <span class="st">"//a[@href]"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_attr</span>(<span class="st">'href'</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(links)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "?C=N;O=D"              "?C=M;O=A"              "?C=S;O=A"             
[4] "?C=D;O=A"              "/pub/data/ghcn/daily/" "1750.csv.gz"          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="do">## we can extract various information</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>listOfANodes <span class="ot">&lt;-</span> <span class="fu">read_html</span>(URL) <span class="sc">%&gt;%</span> <span class="fu">html_elements</span>(<span class="at">xpath =</span> <span class="st">"//a[@href]"</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>listOfANodes <span class="sc">%&gt;%</span> <span class="fu">html_attr</span>(<span class="st">'href'</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "?C=N;O=D"              "?C=M;O=A"              "?C=S;O=A"             
 [4] "?C=D;O=A"              "/pub/data/ghcn/daily/" "1750.csv.gz"          
 [7] "1763.csv.gz"           "1764.csv.gz"           "1765.csv.gz"          
[10] "1766.csv.gz"          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>listOfANodes <span class="sc">%&gt;%</span> <span class="fu">html_name</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "a" "a" "a" "a" "a" "a" "a" "a" "a" "a"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>listOfANodes <span class="sc">%&gt;%</span> <span class="fu">html_text</span>()  <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Name"             "Last modified"    "Size"             "Description"     
 [5] "Parent Directory" "1750.csv.gz"      "1763.csv.gz"      "1764.csv.gz"     
 [9] "1765.csv.gz"      "1766.csv.gz"     </code></pre>
</div>
</div>
<p>Here’s another example of extracting specific components of information from a webpage (results not shown, since headlines will vary from day to day).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>URL <span class="ot">&lt;-</span> <span class="st">"https://www.nytimes.com"</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>headlines2 <span class="ot">&lt;-</span> <span class="fu">read_html</span>(URL) <span class="sc">%&gt;%</span> <span class="fu">html_elements</span>(<span class="st">"h2"</span>) <span class="sc">%&gt;%</span> <span class="fu">html_text</span>()</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(headlines2)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>headlines3 <span class="ot">&lt;-</span> <span class="fu">read_html</span>(URL) <span class="sc">%&gt;%</span> <span class="fu">html_elements</span>(<span class="st">"h3"</span>) <span class="sc">%&gt;%</span> <span class="fu">html_text</span>()</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(headlines3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="xml" class="level2">
<h2 class="anchored" data-anchor-id="xml">XML</h2>
<p>XML is a markup language used to store data in self-describing (no metadata needed) format, often with a hierarchical structure. It consists of sets of elements (also known as nodes because they generally occur in a hierarchical structure and therefore have parents, children, etc.) with tags that identify/name the elements, with some similarity to HTML. Some examples of the use of XML include serving as the underlying format for Microsoft Office and Google Docs documents and for the KML language used for spatial information in Google Earth.</p>
<p>Here’s a brief example. The book with id attribute <em>bk101</em> is an element; the author of the book is also an element that is a child element of the book. The id attribute allows us to uniquely identify the element.</p>
<pre><code>    &lt;?xml version="1.0"?&gt;
    &lt;catalog&gt;
       &lt;book id="bk101"&gt;
          &lt;author&gt;Gambardella, Matthew&lt;/author&gt;
          &lt;title&gt;XML Developer's Guide&lt;/title&gt;
          &lt;genre&gt;Computer&lt;/genre&gt;
          &lt;price&gt;44.95&lt;/price&gt;
          &lt;publish_date&gt;2000-10-01&lt;/publish_date&gt;
          &lt;description&gt;An in-depth look at creating applications with XML.&lt;/description&gt;
       &lt;/book&gt;
       &lt;book id="bk102"&gt;
          &lt;author&gt;Ralls, Kim&lt;/author&gt;
          &lt;title&gt;Midnight Rain&lt;/title&gt;
          &lt;genre&gt;Fantasy&lt;/genre&gt;
          &lt;price&gt;5.95&lt;/price&gt;
          &lt;publish_date&gt;2000-12-16&lt;/publish_date&gt;
         &lt;description&gt;A former architect battles corporate zombies, an evil sorceress, and her own childhood to become queen of the world.&lt;/description&gt;
       &lt;/book&gt;
    &lt;/catalog&gt;</code></pre>
<p>We can read XML documents into R using <code>xml2::read_xml()</code> and then manipulate it using other functions from the <em>xml2</em> package. Here’s an example of working with lending data from the Kiva lending non-profit. You can see the XML format in a browser at</p>
<p><a href="http://api.kivaws.org/v1/loans/newest.xml" class="uri">http://api.kivaws.org/v1/loans/newest.xml</a>.</p>
<p>XML documents have a tree structure with information at nodes. As above with HTML, one can use the <em>XPath</em> language for navigating the tree and finding and extracting information from the node(s) of interest.</p>
<p>Here is some example code for extracting loan info from the Kiva data. We’ll first show the ‘brute force’ approach of working with the data as a list and then the better approach of using XPath.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">read_xml</span>(<span class="st">"https://api.kivaws.org/v1/loans/newest.xml"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as_list</span>(doc)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "response"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data<span class="sc">$</span>response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "paging" "loans" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(data<span class="sc">$</span>response<span class="sc">$</span>loans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>response<span class="sc">$</span>loans[[<span class="dv">2</span>]][<span class="fu">c</span>(<span class="st">'name'</span>, <span class="st">'activity'</span>,</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'sector'</span>, <span class="st">'location'</span>, <span class="st">'loan_amount'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$name
$name[[1]]
[1] "Piseth"


$activity
$activity[[1]]
[1] "Home Energy"


$sector
$sector[[1]]
[1] "Personal Use"


$location
$location$country_code
$location$country_code[[1]]
[1] "KH"


$location$country
$location$country[[1]]
[1] "Cambodia"


$location$town
$location$town[[1]]
[1] "Siem Reap"


$location$geo
$location$geo$level
$location$geo$level[[1]]
[1] "town"


$location$geo$pairs
$location$geo$pairs[[1]]
[1] "13.366667 103.85"


$location$geo$type
$location$geo$type[[1]]
[1] "point"




$loan_amount
$loan_amount[[1]]
[1] "800"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="do">## alternatively, extract only the 'loans' info (and use pipes)</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>loansNode <span class="ot">&lt;-</span> doc <span class="sc">%&gt;%</span> <span class="fu">html_elements</span>(<span class="st">'loans'</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>loanInfo <span class="ot">&lt;-</span> loansNode <span class="sc">%&gt;%</span> <span class="fu">xml_children</span>() <span class="sc">%&gt;%</span> <span class="fu">as_list</span>()</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(loanInfo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(loanInfo[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "id"                       "name"                    
 [3] "description"              "status"                  
 [5] "funded_amount"            "basket_amount"           
 [7] "image"                    "activity"                
 [9] "sector"                   "themes"                  
[11] "use"                      "location"                
[13] "partner_id"               "posted_date"             
[15] "planned_expiration_date"  "loan_amount"             
[17] "borrower_count"           "lender_count"            
[19] "bonus_credit_eligibility" "tags"                    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(loanInfo[[<span class="dv">1</span>]]<span class="sc">$</span>location)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "country_code" "country"      "town"         "geo"         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="do">## suppose we only want the country locations of the loans (using XPath)</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xml_find_all</span>(loansNode, <span class="st">'//location//country'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (20)}
 [1] &lt;country&gt;Cambodia&lt;/country&gt;
 [2] &lt;country&gt;Cambodia&lt;/country&gt;
 [3] &lt;country&gt;Cambodia&lt;/country&gt;
 [4] &lt;country&gt;Cambodia&lt;/country&gt;
 [5] &lt;country&gt;Ecuador&lt;/country&gt;
 [6] &lt;country&gt;Cambodia&lt;/country&gt;
 [7] &lt;country&gt;Vietnam&lt;/country&gt;
 [8] &lt;country&gt;Vietnam&lt;/country&gt;
 [9] &lt;country&gt;Guatemala&lt;/country&gt;
[10] &lt;country&gt;Timor-Leste&lt;/country&gt;
[11] &lt;country&gt;El Salvador&lt;/country&gt;
[12] &lt;country&gt;Colombia&lt;/country&gt;
[13] &lt;country&gt;Colombia&lt;/country&gt;
[14] &lt;country&gt;Kenya&lt;/country&gt;
[15] &lt;country&gt;Kenya&lt;/country&gt;
[16] &lt;country&gt;Kenya&lt;/country&gt;
[17] &lt;country&gt;Kenya&lt;/country&gt;
[18] &lt;country&gt;Colombia&lt;/country&gt;
[19] &lt;country&gt;Colombia&lt;/country&gt;
[20] &lt;country&gt;Honduras&lt;/country&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xml_find_all</span>(loansNode, <span class="st">'//location//country'</span>) <span class="sc">%&gt;%</span> <span class="fu">xml_text</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Cambodia"    "Cambodia"    "Cambodia"    "Cambodia"    "Ecuador"    
 [6] "Cambodia"    "Vietnam"     "Vietnam"     "Guatemala"   "Timor-Leste"
[11] "El Salvador" "Colombia"    "Colombia"    "Kenya"       "Kenya"      
[16] "Kenya"       "Kenya"       "Colombia"    "Colombia"    "Honduras"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="do">## or extract the geographic coordinates</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xml_find_all</span>(loansNode, <span class="st">'//location//geo/pairs'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (20)}
 [1] &lt;pairs&gt;13.09573 103.202206&lt;/pairs&gt;
 [2] &lt;pairs&gt;13.366667 103.85&lt;/pairs&gt;
 [3] &lt;pairs&gt;13.366667 103.85&lt;/pairs&gt;
 [4] &lt;pairs&gt;13.366667 103.85&lt;/pairs&gt;
 [5] &lt;pairs&gt;0.339176 -78.122234&lt;/pairs&gt;
 [6] &lt;pairs&gt;12.5 104&lt;/pairs&gt;
 [7] &lt;pairs&gt;21.40639 103.032155&lt;/pairs&gt;
 [8] &lt;pairs&gt;21.40639 103.032155&lt;/pairs&gt;
 [9] &lt;pairs&gt;14.421598 -91.404825&lt;/pairs&gt;
[10] &lt;pairs&gt;-8.930576 125.396797&lt;/pairs&gt;
[11] &lt;pairs&gt;13.833333 -88.916667&lt;/pairs&gt;
[12] &lt;pairs&gt;4 -72&lt;/pairs&gt;
[13] &lt;pairs&gt;5.472709 -74.667984&lt;/pairs&gt;
[14] &lt;pairs&gt;0.516667 35.283333&lt;/pairs&gt;
[15] &lt;pairs&gt;-0.785561 35.33914&lt;/pairs&gt;
[16] &lt;pairs&gt;0.035164 36.364292&lt;/pairs&gt;
[17] &lt;pairs&gt;-0.777114 34.945839&lt;/pairs&gt;
[18] &lt;pairs&gt;11.004107 -74.806981&lt;/pairs&gt;
[19] &lt;pairs&gt;10.391049 -75.479426&lt;/pairs&gt;
[20] &lt;pairs&gt;15.047154 -85.125776&lt;/pairs&gt;</code></pre>
</div>
</div>
</section>
<section id="json" class="level2">
<h2 class="anchored" data-anchor-id="json">JSON</h2>
<p>JSON files are structured as “attribute-value” pairs (aka “key-value” pairs), often with a hierarchical structure. Here’s a brief example:</p>
<pre><code>    {
      "firstName": "John",
      "lastName": "Smith",
      "isAlive": true,
      "age": 25,
      "address": {
        "streetAddress": "21 2nd Street",
        "city": "New York",
        "state": "NY",
        "postalCode": "10021-3100"
      },
      "phoneNumbers": [
        {
          "type": "home",
          "number": "212 555-1234"
        },
        {
          "type": "office",
          "number": "646 555-4567"
        }
      ],
      "children": [],
      "spouse": null
    }</code></pre>
<p>A set of key-value pairs is a named array and is placed inside braces (squiggly brackets). Note the nestedness of arrays within arrays (e.g., address within the overarching person array and the use of square brackets for unnamed arrays (i.e., vectors of information), as well as the use of different types: character strings, numbers, null, and (not shown) boolean/logical values. JSON and XML can be used in similar ways, but JSON is less <em>verbose</em> than XML.</p>
<p>We can read JSON into R using <em>fromJSON()</em> in the <em>jsonlite</em> package. Let’s play again with the Kiva data. The same data that we had worked with in XML format is also available in JSON format: <a href="http://api.kivaws.org/v1/loans/newest.json" class="uri">http://api.kivaws.org/v1/loans/newest.json</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="st">"http://api.kivaws.org/v1/loans/newest.json"</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "paging" "loans" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(data<span class="sc">$</span>loans) <span class="co"># nice!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data<span class="sc">$</span>loans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       id           name languages      status funded_amount basket_amount
1 2426966            Hon        en fundraising            25            25
2 2426991         Piseth        en fundraising             0             0
3 2444685         Sareth        en fundraising             0             0
4 2444689           Kheu        en fundraising             0             0
5 2425164 Maria Consuelo    es, en fundraising             0             0
6 2444680         Sophat        en fundraising             0             0
  image.id image.template_id    activity       sector
1  4946099                 1 Home Energy Personal Use
2  4934240                 1 Home Energy Personal Use
3  4947188                 1      Crafts         Arts
4  4947194                 1      Crafts         Arts
5  4914714                 1  Restaurant         Food
6  4947060                 1     Farming  Agriculture
                                  themes
1 Social Enterprise, Clean Energy, Green
2 Social Enterprise, Clean Energy, Green
3                      Underfunded Areas
4                      Underfunded Areas
5                                   NULL
6                                   NULL
                                                                                            use
1          to buy a biodigester that reduces kitchen smoke with biogas replacing the wood fuel.
2          to buy a biodigester that reduces kitchen smoke with biogas replacing the wood fuel.
3    to purchase more rattan and tropical fruit trees for making baskets to sell in the market.
4    to purchase more rattan and tropical fruit trees for making baskets to sell in the market.
5 to acquire cooking utensils and an industrial stove, as well as make renovations to her shop.
6                             to buy rice seeds and fertilizer to support her farming business.
  location.country_code location.country location.town location.geo.level
1                    KH         Cambodia    Battambang               town
2                    KH         Cambodia     Siem Reap               town
3                    KH         Cambodia     Siem Reap               town
4                    KH         Cambodia     Siem Reap               town
5                    EC          Ecuador        Ibarra               town
6                    KH         Cambodia        Pursat               town
   location.geo.pairs location.geo.type partner_id          posted_date
1 13.09573 103.202206             point        636 2022-09-07T15:40:51Z
2    13.366667 103.85             point        636 2022-09-07T15:40:51Z
3    13.366667 103.85             point        499 2022-09-07T15:40:51Z
4    13.366667 103.85             point        499 2022-09-07T15:40:51Z
5 0.339176 -78.122234             point        457 2022-09-07T15:40:50Z
6            12.5 104             point        499 2022-09-07T15:40:50Z
  planned_expiration_date loan_amount borrower_count lender_count
1    2022-10-12T15:40:51Z         800              1            1
2    2022-10-12T15:40:51Z         800              1            0
3    2022-10-12T15:40:51Z         800              1            0
4    2022-10-12T15:40:51Z         525              1            0
5    2022-10-12T15:40:50Z        1600              1            0
6    2022-10-12T15:40:50Z         500              1            0
  bonus_credit_eligibility
1                    FALSE
2                    FALSE
3                     TRUE
4                     TRUE
5                    FALSE
6                     TRUE
                                                                         tags
1                                                            #Eco-friendly, 9
2                                                                        NULL
3                            #Woman-Owned Business, #Supporting Family, 6, 31
4                            #Woman-Owned Business, #Supporting Family, 6, 31
5 #Woman-Owned Business, #Biz Durable Asset, #Repair Renew Replace, 6, 35, 39
6                          #Woman-Owned Business, #Vegan, #Elderly, 6, 10, 13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>loans[<span class="dv">1</span>, <span class="st">'location.geo.pairs'</span>] <span class="co"># hmmm...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>loans[<span class="dv">1</span>, <span class="st">'location'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  country_code  country       town geo.level           geo.pairs geo.type
1           KH Cambodia Battambang      town 13.09573 103.202206    point</code></pre>
</div>
</div>
<p>One disadvantage of JSON is that it is not set up to deal with missing values, infinity, etc.</p>
</section>
<section id="webscraping-and-web-apis" class="level2">
<h2 class="anchored" data-anchor-id="webscraping-and-web-apis">Webscraping and web APIs</h2>
<p>Here we’ll see some examples of making requests over the Web to get data. We’ll use APIs to systematically query a website for information. Ideally, but not always, the API will be documented. In many cases that simply amounts to making an HTTP GET request, which is done by constructing a URL.</p>
<p>The packages <em>RCurl</em> and <em>httr</em> are useful for a wide variety of such functionality. Note that much of the functionality I describe below is also possible within the shell using either <em>wget</em> or <em>curl</em>.</p>
<section id="webscraping-ethics-and-best-practices" class="level3">
<h3 class="anchored" data-anchor-id="webscraping-ethics-and-best-practices">Webscraping ethics and best practices</h3>
<p>Webscraping is the process of extracting data from the web, either directly from a website or using a web API (application programming interface).</p>
<ol type="1">
<li><p><strong>Should you webscrape?</strong> In general, if we can avoid webscraping (particularly if there is not an API) and instead directly download a data file from a website, that is greatly preferred.</p></li>
<li><p><strong>May you webscrape?</strong> Before you set up any automated downloading of materials/data from the web you should make sure that what you are about to do is consistent with the rules provided by the website.</p></li>
</ol>
<p>Some places to look for information on what the website allows are:</p>
<ul>
<li><p>legal pages such as Terms of Service or Terms and Conditions on the website.</p></li>
<li><p>check the robots.txt file (e.g., <a href="https://scholar.google.com/robots.txt" class="uri">https://scholar.google.com/robots.txt</a>) to see what a web crawler is allowed to do, and whether the site requires a particular delay between requests to the sites</p></li>
<li><p>potentially contact the site owner if you plan to scrape a large amount of data</p></li>
</ul>
<p>Here are some links with useful information:</p>
<ul>
<li><p><a href="http://feedproxy.google.com/~r/RBloggers/~3/RZGJ8Trv5Xw/?utm_source=feedburner&amp;utm_medium=email">A blog post overview on webscraping and robots.txt</a></p></li>
<li><p><a href="https://towardsdatascience.com/ethics-in-web-scraping-b96b18136f01">Blog post on webscraping ethics</a></p></li>
<li><p><a href="https://www.promptcloud.com/blog/how-to-read-and-respect-robots-file">Some information on how to understand a robots.txt file</a></p></li>
</ul>
<p>Tips for when you make automated requests:</p>
<ul>
<li>When debugging code that processes the result of such a request, just run the request once, save (i.e., cache) the result, and then work on the processing code applied to the result. Don’t make the same request over and over again.</li>
<li>In many cases you will want to include a time delay between your automated requests to a site, including if you are not actually crawling a site but just want to automate a small number of queries.</li>
</ul>
</section>
<section id="what-is-http" class="level3">
<h3 class="anchored" data-anchor-id="what-is-http">What is HTTP?</h3>
<p>HTTP (hypertext transfer protocol) is a system for communicating information from a server (i.e., the website of interest) to a client (e.g., your laptop). The client sends a request and the server sends a response.</p>
<p>When you go to a website in a browser, your browser makes an HTTP GET request to the website. Similarly, when we did some downloading of html from webpages above, we used an HTTP GET request.</p>
<p>Anytime the URL you enter includes parameter information after a question mark (<code>www.somewebsite.com?param1=arg1&amp;param2=arg2</code>), you are using an API.</p>
<p>The response to an HTTP request will include a status code, which can be interpreted based on <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">this information</a>.</p>
<p>The response will generally contain content in the form of text (e.g., HTML, XML, JSON) or raw bytes.</p>
</section>
<section id="apis-rest--and-soap-based-web-services" class="level3">
<h3 class="anchored" data-anchor-id="apis-rest--and-soap-based-web-services">APIs: REST- and SOAP-based web services</h3>
<p>Ideally a web service documents their API (Applications Programming Interface) that serves data or allows other interactions. REST and SOAP are popular API standards/styles. Both REST and SOAP use HTTP requests; we’ll focus on REST as it is more common and simpler. When using REST, we access <em>resources</em>, which might be a Facebook account or a database of stock quotes. The API will (hopefully) document what information it expects from the user and will return the result in a standard format (often a particular file format rather than producing a webpage).</p>
<p>Often the format of the request is a URL (aka an endpoint) plus a query string, passed as a GET request. Let’s search for plumbers near Berkeley, and we’ll see the GET request, in the form:</p>
<p><a href="https://www.yelp.com/search?find_desc=plumbers&amp;find_loc=Berkeley+CA&amp;ns=1" class="uri">https://www.yelp.com/search?find_desc=plumbers&amp;find_loc=Berkeley+CA&amp;ns=1</a></p>
<ul>
<li><p>the query string begins with ?</p></li>
<li><p>there are one or more <code>Parameter=Argument</code> pairs</p></li>
<li><p>pairs are separated by &amp;</p></li>
<li><p>+ is used in place of each space</p></li>
</ul>
<p>Let’s see an example of accessing economic data from the World Bank, using the <a href="https://datahelpdesk.worldbank.org/knowledgebase/topics/125589-developer-information">documentation for their API</a>. Following the <a href="https://datahelpdesk.worldbank.org/knowledgebase/articles/898581-api-basic-call-structures">API call structure</a>, we can download (for example), data on various countries. The documentation indicates that our REST-based query can use either a URL structure or an argument-based structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Queries based on the documentation</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>api_url <span class="ot">&lt;-</span> <span class="st">"http://api.worldbank.org/V2/incomeLevel/LIC/country"</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>api_args <span class="ot">&lt;-</span> <span class="st">"http://api.worldbank.org/V2/country?incomeLevel=LIC"</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Generalizing a bit</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="st">"http://api.worldbank.org/V2/country?incomeLevel=MIC&amp;format=json"</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(req)</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Be careful of data truncation/pagination</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="st">"http://api.worldbank.org/V2/country?incomeLevel=MIC&amp;format=json&amp;per_page=1000"</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(req)</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Programmatic control</span></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>baseURL <span class="ot">&lt;-</span> <span class="st">"http://api.worldbank.org/V2/country"</span></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>group <span class="ot">&lt;-</span> <span class="st">'MIC'</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>format <span class="ot">&lt;-</span> <span class="st">'json'</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">incomeLevel =</span> group, <span class="at">format =</span> format, <span class="at">per_page =</span> <span class="dv">1000</span>)</span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(baseURL, <span class="st">"?"</span>,</span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(  <span class="fu">paste</span>(<span class="fu">names</span>(args), args, <span class="at">sep =</span> <span class="st">"="</span>),  <span class="at">collapse =</span> <span class="st">"&amp;"</span>))</span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   id iso2Code           name region.id region.iso2code
1 AGO       AO         Angola       SSF              ZG
2 ALB       AL        Albania       ECS              Z7
3 ARG       AR      Argentina       LCN              ZJ
4 ARM       AM        Armenia       ECS              Z7
5 ASM       AS American Samoa       EAS              Z4
6 AZE       AZ     Azerbaijan       ECS              Z7
                region.value adminregion.id adminregion.iso2code
1        Sub-Saharan Africa             SSA                   ZF
2      Europe &amp; Central Asia            ECA                   7E
3 Latin America &amp; Caribbean             LAC                   XJ
4      Europe &amp; Central Asia            ECA                   7E
5        East Asia &amp; Pacific            EAP                   4E
6      Europe &amp; Central Asia            ECA                   7E
                                  adminregion.value incomeLevel.id
1        Sub-Saharan Africa (excluding high income)            LMC
2     Europe &amp; Central Asia (excluding high income)            UMC
3 Latin America &amp; Caribbean (excluding high income)            UMC
4     Europe &amp; Central Asia (excluding high income)            UMC
5       East Asia &amp; Pacific (excluding high income)            UMC
6     Europe &amp; Central Asia (excluding high income)            UMC
  incomeLevel.iso2code   incomeLevel.value lendingType.id lendingType.iso2code
1                   XN Lower middle income            IBD                   XF
2                   XT Upper middle income            IBD                   XF
3                   XT Upper middle income            IBD                   XF
4                   XT Upper middle income            IBD                   XF
5                   XT Upper middle income            LNX                   XX
6                   XT Upper middle income            IBD                   XF
  lendingType.value  capitalCity longitude latitude
1              IBRD       Luanda    13.242 -8.81155
2              IBRD       Tirane   19.8172  41.3317
3              IBRD Buenos Aires  -58.4173 -34.6118
4              IBRD      Yerevan    44.509  40.1596
5    Not classified    Pago Pago  -170.691 -14.2846
6              IBRD         Baku   49.8932  40.3834</code></pre>
</div>
</div>
<p>APIs can change and disappear. Last year the example above involved the World Bank’s Climate Data API, which I can no longer find!</p>
<p>As another example, here we can see the <a href="https://fiscaldata.treasury.gov/api-documentation/">US Treasury Department API</a>, which allows us to construct queries for federal financial data.</p>
<p>The Nolan and Temple Lang book provides a number of examples of different ways of authenticating with web services that control access to the service.</p>
<p>Finally, some web services allow us to pass information to the service in addition to just getting data or information. E.g., you can programmatically interact with your Facebook, Dropbox, and Google Drive accounts using REST based on HTTP POST, PUT, and DELETE requests. Authentication is of course important in these contexts and some times you would first authenticate with your login and password and receive a “token”. This token would then be used in subsequent interactions in the same session.</p>
<p>I created your <em>github.berkeley.edu</em> accounts from Python by interacting with the <a href="https://docs.github.com/en/rest/reference/repos">GitHub API</a> using the <em>requests</em> package.</p>
</section>
<section id="http-requests-by-deconstructing-an-undocumented-api" class="level3">
<h3 class="anchored" data-anchor-id="http-requests-by-deconstructing-an-undocumented-api">HTTP requests by deconstructing an (undocumented) API</h3>
<p>In some cases an API may not be documented or we might be lazy and not use the documentation. Instead we might deconstruct the queries a browser makes and then mimic that behavior, in some cases having to parse HTML output to get at data. Note that if the webpage changes even a little bit, our carefully constructed query syntax may fail.</p>
<p>Let’s look at some UN data (agricultural crop data). By going to<br>
<a href="http://data.un.org/Explorer.aspx?d=FAO" class="uri">http://data.un.org/Explorer.aspx?d=FAO</a>, and clicking on “Crops”, we’ll see a bunch of agricultural products with “View data” links. Click on “apricots” as an example and you’ll see a “Download” button that allows you to download a CSV of the data. Let’s select a range of years and then try to download “by hand”. Sometimes we can right-click on the link that will download the data and directly see the URL that is being accessed and then one can deconstruct it so that you can create URLs programmatically to download the data you want.</p>
<p>In this case, we can’t see the full URL that is being used because there’s some Javascript involved. Therefore, rather than looking at the URL associated with a link we need to view the actual HTTP request sent by our browser to the server. We can do this using features of the browser (e.g., in Firefox see <code>Web Developer -&gt; Network</code> and in Chrome <code>View -&gt; Developer -&gt; Developer tools</code> and choose the <code>Network</code> tab) (or right-click on the webpage and select <code>Inspect</code> and then <code>Network</code>). Based on this we can see that an HTTP GET request is being used with a URL such as:<br>
<a href="http://data.un.org/Handlers/DownloadHandler.ashx?DataFilter=itemCode:526;year:2012,2013,2014,2015,2016,2017&amp;DataMartId=FAO&amp;Format=csv&amp;c=2,4,5,6,7&amp;s=countryName:asc,elementCode:asc,year:desc" class="uri">http://data.un.org/Handlers/DownloadHandler.ashx?DataFilter=itemCode:526;year:2012,2013,2014,2015,2016,2017&amp;DataMartId=FAO&amp;Format=csv&amp;c=2,4,5,6,7&amp;s=countryName:asc,elementCode:asc,year:desc</a>.</p>
<p>We’e now able to easily download the data using that URL, which we can fairly easily construct using string processing in bash, R, or Python, such as this (here I just paste it together directly, but using more structured syntax such as I used for the World Bank example would be better):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="do">## example URL:</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="do">## http://data.un.org/Handlers/DownloadHandler.ashx?DataFilter=itemCode:526;</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="do">##year:2012,2013,2014,2015,2016,2017&amp;DataMartId=FAO&amp;Format=csv&amp;c=2,4,5,6,7&amp;</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="do">##s=countryName:asc,elementCode:asc,year:desc</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>itemCode <span class="ot">&lt;-</span> <span class="dv">526</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>baseURL <span class="ot">&lt;-</span> <span class="st">"http://data.un.org/Handlers/DownloadHandler.ashx"</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>yrs <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">as.character</span>(<span class="dv">2012</span><span class="sc">:</span><span class="dv">2017</span>), <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>filter <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"?DataFilter=itemCode:"</span>, itemCode, <span class="st">";year:"</span>, yrs)</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>args1 <span class="ot">&lt;-</span> <span class="st">"&amp;DataMartId=FAO&amp;Format=csv&amp;c=2,3,4,5,6,7&amp;"</span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>args2 <span class="ot">&lt;-</span> <span class="st">"s=countryName:asc,elementCode:asc,year:desc"</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(baseURL, filter, args1, args2)</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a><span class="do">## if the website provided a CSV we could just do this:</span></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="do">## apricots &lt;- read.csv(url)</span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a><span class="do">## but it zips the file</span></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()  <span class="do">## give name for a temporary file</span></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(url, temp)</span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">unzip</span>(temp))  <span class="do">## using a connection (see Section 2)</span></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Country.or.Area Element.Code                                         Element
1     Afghanistan          432 Gross Production Index Number (2014-2016 = 100)
2     Afghanistan          432 Gross Production Index Number (2014-2016 = 100)
3     Afghanistan          432 Gross Production Index Number (2014-2016 = 100)
4     Afghanistan          432 Gross Production Index Number (2014-2016 = 100)
5     Afghanistan          432 Gross Production Index Number (2014-2016 = 100)
6     Afghanistan          432 Gross Production Index Number (2014-2016 = 100)
  Year  Unit  Value Value.Footnotes
1 2017 index 202.19              Fc
2 2016 index  27.45              Fc
3 2015 index 134.50              Fc
4 2014 index 138.05              Fc
5 2013 index 138.05              Fc
6 2012 index 128.08              Fc</code></pre>
</div>
</div>
<p>So, what have we achieved?</p>
<ol type="1">
<li><p>We have a reproducible workflow we can share with others (perhaps ourself in the future).</p></li>
<li><p>We can automate the process of downloading many such files.</p></li>
</ol>
</section>
<section id="more-details-on-http-requests" class="level3">
<h3 class="anchored" data-anchor-id="more-details-on-http-requests">More details on HTTP requests</h3>
<p>A more sophisticated way to do the download is to pass the request in a structured way with named input parameters. This request is easier to construct programmatically. Here what is returned is a zip file, which is represented in R as a sequence of “raw” bytes. We can use httr’s GET(), followed by writing to disk and reading back in, as follows (for some reason knitr won’t print the output…):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'httr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:curl':

    handle_reset</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>output2 <span class="ot">&lt;-</span> <span class="fu">GET</span>(baseURL, <span class="at">query =</span> <span class="fu">list</span>(</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">DataFilter =</span> <span class="fu">paste0</span>(<span class="st">"itemCode:"</span>, itemCode, <span class="st">";year:"</span>, yrs),</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">DataMartID =</span> <span class="st">"FAO"</span>, <span class="at">Format =</span> <span class="st">"csv"</span>, <span class="at">c =</span> <span class="st">"2,3,4,5,6,7"</span>,</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">s =</span> <span class="st">"countryName:asc,elementCode:asc,year:desc"</span>))</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()  <span class="do">## give name for a temporary file</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="fu">writeBin</span>(<span class="fu">content</span>(output2, <span class="st">'raw'</span>), temp)  <span class="do">## write out as zip file</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">unzip</span>(temp))</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Country.or.Area Element.Code                                         Element
1     Afghanistan          432 Gross Production Index Number (2014-2016 = 100)
2     Afghanistan          432 Gross Production Index Number (2014-2016 = 100)
3     Afghanistan          432 Gross Production Index Number (2014-2016 = 100)
4     Afghanistan          432 Gross Production Index Number (2014-2016 = 100)
5     Afghanistan          432 Gross Production Index Number (2014-2016 = 100)
6     Afghanistan          432 Gross Production Index Number (2014-2016 = 100)
  Year  Unit  Value Value.Footnotes
1 2017 index 202.19              Fc
2 2016 index  27.45              Fc
3 2015 index 134.50              Fc
4 2014 index 138.05              Fc
5 2013 index 138.05              Fc
6 2012 index 128.08              Fc</code></pre>
</div>
</div>
<p>In some cases we may need to send a lot of information as part of the URL in a GET request. If it gets to be too long (e.g,, more than 2048 characters) many web servers will reject the request. Instead we may need to use an HTTP POST request (POST requests are often used for submitting web forms). A typical request would have syntax like this search (using <em>RCurl</em>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">url.exists</span>(<span class="st">'http://www.wormbase.org/db/searches/advanced/dumper'</span>)) {</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">=</span> <span class="fu">postForm</span>(<span class="st">'http://www.wormbase.org/db/searches/advanced/dumper'</span>,</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">species=</span><span class="st">"briggsae"</span>,</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">list=</span><span class="st">""</span>,</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">flank3=</span><span class="st">"0"</span>,</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">flank5=</span><span class="st">"0"</span>,</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">feature=</span><span class="st">"Gene Models"</span>,</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">dump =</span> <span class="st">"Plain TEXT"</span>,</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">orientation =</span> <span class="st">"Relative to feature"</span>,</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">relative =</span> <span class="st">"Chromsome"</span>,</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">DNA =</span><span class="st">"flanking sequences only"</span>,</span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">.cgifields =</span> <span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">"feature"</span>, <span class="st">"orientation"</span>, <span class="st">"DNA"</span>,</span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"dump"</span>,<span class="st">"relative"</span>), <span class="at">collapse=</span><span class="st">", "</span>))</span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unfortunately that specific search doesn’t work because the server URL and/or API seem to have changed. But it gives you an idea of what the format would look like.</p>
<p><em>httr</em> and <em>RCurl</em> can handle other kinds of HTTP requests such as PUT and DELETE. Finally, some websites use cookies to keep track of users and you may need to download a cookie in the first interaction with the HTTP server and then send that cookie with later interactions. More details are available in the Nolan and Temple Lang book.</p>
</section>
<section id="packaged-access-to-an-api" class="level3">
<h3 class="anchored" data-anchor-id="packaged-access-to-an-api">Packaged access to an API</h3>
<p>For popular websites/data sources, a developer may have packaged up the API calls in a user-friendly fashion for use from R, Python or other software. For example there are Python (twitter) and R (twitteR) packages for interfacing with Twitter via its API.</p>
<p>Here’s some example code for Python (the Python package seems to be more fully-featured than the R package). This looks up the US senators’ Twitter names and then downloads a portion of each of their timelines, i.e., the time series of their tweets. Note that Twitter has limits on how much one can download at once.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> twitter</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="co"># You will need to set the following variables with your</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="co"># personal information.  To do this you will need to create</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="co"># a personal account on Twitter (if you don't already have</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="co"># one).  Once you've created an account, create a new</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="co"># application here:</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="co">#    https://dev.twitter.com/apps</span></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a><span class="co"># You can manage your applications here:</span></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a><span class="co">#    https://apps.twitter.com/</span></span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Select your application and then under the section labeled</span></span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a><span class="co"># "Key and Access Tokens", you will find the information needed</span></span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a><span class="co"># below.  Keep this information private.</span></span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a>CONSUMER_KEY       <span class="op">=</span> <span class="st">""</span></span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a>CONSUMER_SECRET    <span class="op">=</span> <span class="st">""</span></span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a>OAUTH_TOKEN        <span class="op">=</span> <span class="st">""</span></span>
<span id="cb126-20"><a href="#cb126-20" aria-hidden="true" tabindex="-1"></a>OAUTH_TOKEN_SECRET <span class="op">=</span> <span class="st">""</span></span>
<span id="cb126-21"><a href="#cb126-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-22"><a href="#cb126-22" aria-hidden="true" tabindex="-1"></a>auth <span class="op">=</span> twitter.oauth.OAuth(OAUTH_TOKEN, OAUTH_TOKEN_SECRET,</span>
<span id="cb126-23"><a href="#cb126-23" aria-hidden="true" tabindex="-1"></a>                           CONSUMER_KEY, CONSUMER_SECRET)</span>
<span id="cb126-24"><a href="#cb126-24" aria-hidden="true" tabindex="-1"></a>api <span class="op">=</span> twitter.Twitter(auth<span class="op">=</span>auth)</span>
<span id="cb126-25"><a href="#cb126-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-26"><a href="#cb126-26" aria-hidden="true" tabindex="-1"></a><span class="co"># get the list of senators</span></span>
<span id="cb126-27"><a href="#cb126-27" aria-hidden="true" tabindex="-1"></a>senators <span class="op">=</span> api.lists.members(owner_screen_name<span class="op">=</span><span class="st">"gov"</span>, slug<span class="op">=</span><span class="st">"us-senate"</span>, count<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb126-28"><a href="#cb126-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-29"><a href="#cb126-29" aria-hidden="true" tabindex="-1"></a><span class="co"># get all the senators' timelines</span></span>
<span id="cb126-30"><a href="#cb126-30" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> [d[<span class="st">"screen_name"</span>] <span class="cf">for</span> d <span class="kw">in</span> senators[<span class="st">"users"</span>]]</span>
<span id="cb126-31"><a href="#cb126-31" aria-hidden="true" tabindex="-1"></a>timelines <span class="op">=</span> [api.statuses.user_timeline(screen_name<span class="op">=</span>name, count <span class="op">=</span> <span class="dv">500</span>) </span>
<span id="cb126-32"><a href="#cb126-32" aria-hidden="true" tabindex="-1"></a>             <span class="cf">for</span> name <span class="kw">in</span> names]</span>
<span id="cb126-33"><a href="#cb126-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-34"><a href="#cb126-34" aria-hidden="true" tabindex="-1"></a><span class="co"># save information out to JSON</span></span>
<span id="cb126-35"><a href="#cb126-35" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"senators-list.json"</span>, <span class="st">"w"</span>) <span class="im">as</span> f:</span>
<span id="cb126-36"><a href="#cb126-36" aria-hidden="true" tabindex="-1"></a>    json.dump(senators, f, indent<span class="op">=</span><span class="dv">4</span>, sort_keys<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb126-37"><a href="#cb126-37" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"timelines.json"</span>, <span class="st">"w"</span>) <span class="im">as</span> f:</span>
<span id="cb126-38"><a href="#cb126-38" aria-hidden="true" tabindex="-1"></a>    json.dump(timelines, f, indent<span class="op">=</span><span class="dv">4</span>, sort_keys<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="accessing-dynamic-pages" class="level3">
<h3 class="anchored" data-anchor-id="accessing-dynamic-pages">Accessing dynamic pages</h3>
<p>Some websites dynamically change in reaction to the user behavior. In these cases you need a tool that can mimic the behavior of a human interacting with a site. Some options are:</p>
<ul>
<li><p><em>selenium</em> (and the <em>RSelenium</em> wrapper for R) is a popular tool for doing this.</p></li>
<li><p><em>splash</em> (and the <em>splashr</em> wrapper for R) is another approach.</p></li>
<li><p><em>htmlunit</em> is another tool for this.</p></li>
</ul>
</section>
</section>
</section>
<section id="file-and-string-encodings" class="level1">
<h1>5. File and string encodings</h1>
<p>Text (either in the form of a file with regular language in it or a data file with fields of character strings) will often contain characters that are not part of the <a href="http://en.wikipedia.org/wiki/ASCII">limited ASCII set of characters</a>, which has <span class="math inline">\(2^{7}=128\)</span> characters and control codes; basically what you see on a standard US keyboard. Each character takes up one byte (8 bits) of space (there is an unused bit that comes in handy in the UTF-8 context). We can actually hand-generate an ASCII file using the binary representation of each character in R as an illustration.</p>
<p>The letter “M” is encoded based on the ASCII standard in bits as “01001101” as seen in the link above. For convenience, this is often written as two base-16 numbers (i.e., hexadecimal), where “0100”=“4” and “1101”=“d”, hence we have “4d” in hexadecimal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 4d in hexadecimal is 'M'</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 0a is a newline (at least in Linux/Mac)</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="do">## "0x" is how we tell R we are using hexadecimal</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.raw</span>(<span class="fu">c</span>(<span class="st">'0x4d'</span>,<span class="st">'0x6f'</span>, <span class="st">'0x6d'</span>,<span class="st">'0x0a'</span>))  <span class="do">## i.e., "Mom\n" in ascii</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4d 6f 6d 0a</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">charToRaw</span>(<span class="st">'Mom</span><span class="sc">\n</span><span class="st">'</span>)      </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4d 6f 6d 0a</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">writeBin</span>(x, <span class="st">'tmp.txt'</span>)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">readLines</span>(<span class="st">'tmp.txt'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mom"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">'ls -l tmp.txt'</span>, <span class="at">intern =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "-rw-r--r-- 1 paciorek scfstaff 4 Sep  7 08:51 tmp.txt"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">'cat tmp.txt'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When encountering non-ASCII files, in some cases you may need to deal with the text encoding (the mapping of individual characters (including tabs, returns, etc.) to a set of numeric codes). There are a variety of different encodings for text files, with different ones common on different operating systems. <a href="https://en.wikipedia.org/wiki/UTF-8">UTF-8</a> is an encoding for the Unicode characters that includes more than 110,000 characters from 100 different alphabets/scripts. It’s widely used on the web. Latin-1 encodes a small subset of Unicode and contains the characters used in many European languages (e.g., letters with accents). Here’s an example of using a non-ASCII Unicode character:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="do">## n-tilde and division symbol as Unicode 'code points'</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>x2_unicode <span class="ot">&lt;-</span> <span class="st">'Pe\u00f1a 3\u00f72'</span> </span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Encoding</span>(x2_unicode) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "UTF-8"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>x2_unicode</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Peña 3÷2"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">charToRaw</span>(x2_unicode)        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 50 65 c3 b1 61 20 33 c3 b7 32</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">charToRaw</span>(<span class="st">'\u00f1'</span>)    <span class="co"># indeed - two bytes, not one</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] c3 b1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="do">## specified directly as hexadecimal in UTF-8 encoding </span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>x2_utf8 <span class="ot">&lt;-</span> <span class="st">'Pe</span><span class="sc">\xc3\xb1a</span><span class="st"> 3</span><span class="sc">\xc3\xb72</span><span class="st">'</span> </span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>x2_utf8</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Peña 3÷2"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">writeBin</span>(x2_unicode, <span class="st">'tmp2.txt'</span>)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Here n-tilde and division symbol take up two bytes</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="do">## but there is an extraneous null byte in there; not sure why.</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">'ls -l tmp2.txt'</span>) </span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="do">## The system knows how to interpret the UTF-8 encoded file</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="do">## and represent the Unicode character on the screen:</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">'cat tmp2.txt'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>UTF-8 is cleverly designed in terms of the bit-wise representation of characters such that ASCII characters still take up one byte, and most other characters take two bytes, but some take four bytes. In fact it is even more clever than that - the representation is such that the bits of a one-byte character never appear within the representation of a two- or three- or four-byte character (and similarly for two-byte characters in three- or four-byte characters, etc.).</p>
<p>The UNIX utility <em>file</em>, e.g.&nbsp;<code>file tmp.txt</code> can help provide some information. <em>read.table()</em> in R takes arguments <em>fileEncoding</em> and <em>encoding</em> that allow one to specify the encoding as one reads text in. The UNIX utility <em>iconv</em> and the R function <em>iconv()</em> can help with conversions.</p>
<p>In US installations of R, the default encoding is UTF-8; note below that various types of information are interpreted in US English with the encoding UTF-8:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.getlocale</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C"</code></pre>
</div>
</div>
<p>With strings already in R, you can convert between encodings with <em>iconv()</em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="st">"Melhore sua seguran</span><span class="sc">\xe7a</span><span class="st">"</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Encoding</span>(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "unknown"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Encoding</span>(text) <span class="ot">&lt;-</span> <span class="st">"latin1"</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>text  <span class="do">## this prints out correctly in R, but is not correct in the PDF</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Melhore sua segurança"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="st">"Melhore sua seguran</span><span class="sc">\xe7a</span><span class="st">"</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>textUTF8 <span class="ot">&lt;-</span> <span class="fu">iconv</span>(text, <span class="at">from =</span> <span class="st">"latin1"</span>, <span class="at">to =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Encoding</span>(textUTF8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "UTF-8"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>textUTF8</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Melhore sua segurança"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iconv</span>(text, <span class="at">from =</span> <span class="st">"latin1"</span>, <span class="at">to =</span> <span class="st">"ASCII"</span>, <span class="at">sub =</span> <span class="st">"???"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Melhore sua seguran???a"</code></pre>
</div>
</div>
<p>You can also mark a string with an encoding, so R knows how to display it correctly (again, this prints out incorrectly in the PDF):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">"fa</span><span class="sc">\xE7</span><span class="st">ile"</span> </span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Encoding</span>(x) <span class="ot">&lt;-</span> <span class="st">"latin1"</span> </span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "façile"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="do">## playing around... </span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">"</span><span class="sc">\xa1</span><span class="st"> </span><span class="sc">\xa2</span><span class="st"> </span><span class="sc">\xa3</span><span class="st"> </span><span class="sc">\xf1</span><span class="st"> </span><span class="sc">\xf2</span><span class="st">"</span> </span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Encoding</span>(x) <span class="ot">&lt;-</span> <span class="st">"latin1"</span> </span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>x </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "¡ ¢ £ ñ ò"</code></pre>
</div>
</div>
<p>An R error message with multi-byte string in the message often indicates an encoding issue. In particular errors often arise when trying to do string manipulations in R on character vectors for which the encoding is not properly set. Here’s an example with some Internet logging data that we used a few years ago in class in a problem set and which caused some problems.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">'../data/IPs.RData'</span>) <span class="co"># loads in an object named 'text'</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">substring</span>(text, <span class="dv">1</span>, <span class="dv">15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error in substring(text, 1, 15) : 
  invalid multibyte string at '&lt;bf&gt;a7lw8&lt;6c&gt;z2nX,%@ [128.32.244.179] by ncpc-email with ESMTP
(SMTPD32-7.04) id A06E24A0116; Mon, 10 Jun 2002 11:43:42 +0800'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="do">## the issue occurs with the 6402th element (found by trial and error):</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">substring</span>(text[<span class="dv">1</span><span class="sc">:</span><span class="dv">6401</span>],<span class="dv">1</span>,<span class="dv">15</span>))</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">substring</span>(text[<span class="dv">1</span><span class="sc">:</span><span class="dv">6402</span>],<span class="dv">1</span>,<span class="dv">15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error in substring(text[1:6402], 1, 15) : 
  invalid multibyte string at '&lt;bf&gt;a7lw8&lt;6c&gt;z2nX,%@ [128.32.244.179] by ncpc-email with ESMTP
(SMTPD32-7.04) id A06E24A0116; Mon, 10 Jun 2002 11:43:42 +0800'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>text[<span class="dv">6402</span>] <span class="co"># note the Latin-1 character</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "from 5#c\xbfa7lw8lz2nX,%@ [128.32.244.179] by ncpc-email with ESMTP\n(SMTPD32-7.04) id A06E24A0116; Mon, 10 Jun 2002 11:43:42 +0800"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">Encoding</span>(text))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
unknown 
   6936 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Option 1</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Encoding</span>(text) <span class="ot">&lt;-</span> <span class="st">"latin1"</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">substring</span>(text, <span class="dv">1</span>, <span class="dv">15</span>))</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>tmp[<span class="dv">6402</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "from 5#c¿a7lw8l"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Option 2</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">'../data/IPs.RData'</span>) <span class="co"># loads in an object named 'text'</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">substring</span>(text, <span class="dv">1</span>, <span class="dv">15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error in substring(text, 1, 15) : 
  invalid multibyte string at '&lt;bf&gt;a7lw8&lt;6c&gt;z2nX,%@ [128.32.244.179] by ncpc-email with ESMTP
(SMTPD32-7.04) id A06E24A0116; Mon, 10 Jun 2002 11:43:42 +0800'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="fu">iconv</span>(text, <span class="at">from =</span> <span class="st">"latin1"</span>, <span class="at">to =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">substring</span>(text, <span class="dv">1</span>, <span class="dv">15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-structures" class="level1">
<h1>6. Data structures</h1>
<p>As we’re reading data into R or other languages, it’s important to think about the data structures we’ll use to store the information. The data structure we choose can affect:</p>
<ul>
<li>the amount of memory we need,</li>
<li>how quickly we can access the information in the data structure,</li>
<li>how much copying needs to be done to add information to or remove information from the data structure,</li>
<li>how efficiently we can use the data in subsequent computations.</li>
</ul>
<p>This means that what you plan to do with the data should guide what kind of structure you store the data in.</p>
<section id="standard-data-structures-in-r-and-python" class="level2">
<h2 class="anchored" data-anchor-id="standard-data-structures-in-r-and-python">Standard data structures in R and Python</h2>
<ul>
<li>In R and Python, one often ends up working with dataframes, lists, and vectors/matrices/arrays/tensors.</li>
<li>In R, if we are not working with rectangular datasets or standard numerical objects, we often end up using lists or enhanced versions of lists, sometimes with deeply nested structures.</li>
<li>In Python we commonly work with data structures that are part of additional packages, in particular numpy arrays and pandas dataframes.</li>
<li>Dictionaries in Python allow for easy use of key-value pairs where one can access values based on their key/label. In R one can do something similar with named vectors or named lists or (more efficiently) by using environments.</li>
</ul>
<p>In Unit 7, we’ll talk about <em>distributed</em> data structures that allow one to easily work with data distributed across multiple computers.</p>
</section>
<section id="other-kinds-of-data-structures" class="level2">
<h2 class="anchored" data-anchor-id="other-kinds-of-data-structures">Other kinds of data structures</h2>
<p>You may have heard of various other kinds of data structures, such as linked lists, trees, graphs, queues, and stacks. One of the key aspects that differentiate such data structures is how one navigates through the elements.</p>
<p><em>Sets</em> are collections of elements that don’t have any duplicates (like a mathematical set).</p>
<p>With a <em>linked list</em>, with each element (or node) has a value and a pointer (reference) to the location of the next element. (With a doubly-linked list, there is also a pointer back to the previous element.) One big advantage of this is that one can insert an element by simply modifying the pointers involved at the site of the insertion, without copying any of the other elements in the list. A big disadvantage is that to get to an element you have to navigate through the list.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="linked-list.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Linked list (courtesy of computersciencewiki.org)</figcaption><p></p>
</figure>
</div>
<p>Both <em>trees</em> and <em>graphs</em> are collections of nodes (vertices) and links (edges). A tree involves a set of nodes and links to child nodes (also possibly containing information linking the child nodes to their parent nodes). With a graph, the links might not be directional, and there can be cycles.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="tree.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Tree (courtesy of computersciencewiki.org)</figcaption><p></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="graph.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Graph (courtesy of computersciencewiki.org)</figcaption><p></p>
</figure>
</div>
<p>A <em>stack</em> is a collection of elements that behave like a stack of lunch trays. You can only access the top element directly(“last in, first out”), so the operations are that you can push a new element onto the stack or pop the top element off the stack. In fact, nested function calls behave as stacks, and the memory used in the process of evaluating the function calls is called the ‘stack’.</p>
<p>A <em>queue</em> is like the line at a grocery store, behaving as “first in, first out”.</p>
<p>One can use such data structures either directly or via add-on packages in R and Python, though I don’t think they’re all that commonly used in R. This is probably because statistical/data science/machine learning workflows often involve either ‘rectangular’ data (i.e., dataframe-style data) and/or mathematical computations with arrays. That said, trees and graphs are widely used.</p>
<p>Some related concepts that we’ll discuss further in Unit 5 include:</p>
<ul>
<li>types: this refers to how a given piece of information is stored and what operations can be done with the information.
<ul>
<li>‘primitive’ types are the most basic types that often relate directly to how data are stored in memory or on disk (e.g., booleans, integers, numeric (real-valued), character, pointer (address, reference).</li>
</ul></li>
<li>pointers: references to other locations (addresses) in memory. One often uses pointers to avoid unnecessary copying of data.</li>
<li>hashes: hashing involves fast lookup of the value associated with a key (a label), using a hash function, which allows one to convert the key to an address. This avoids having to find the value associated with a specific key by looking through all the keys until the key of interest is found (an O(n) operation).</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../units/unit1-intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Unit 1</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../units/unit3-bash.html" class="pagination-link">
        <span class="nav-page-text">Unit 3</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>