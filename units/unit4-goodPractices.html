<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Chris Paciorek">
<meta name="dcterms.date" content="2022-08-29">

<title>Statistics 243 Fall 2022 - Good practices: coding practices, debugging, and reproducible research</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../units/unit5-programming.html" rel="next">
<link href="../units/unit3-bash.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Statistics 243 Fall 2022</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html">Syllabus</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../office_hours.html">Office hours</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html">Schedule</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-units" role="button" data-bs-toggle="dropdown" aria-expanded="false">Units</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-units">    
        <li>
    <a class="dropdown-item" href="../units/unit1-intro.html">
 <span class="dropdown-text">Unit 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit2-dataTech.html">
 <span class="dropdown-text">Unit 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit3-bash.html">
 <span class="dropdown-text">Unit 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit4-goodPractices.html">
 <span class="dropdown-text">Unit 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit5-programming.html">
 <span class="dropdown-text">Unit 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../units/unit6-parallel.html">
 <span class="dropdown-text">Unit 6</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="button" data-bs-toggle="dropdown" aria-expanded="false">Labs</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="../labs/01/intro_git_knitr.html">
 <span class="dropdown-text">Lab 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/02/assertionsAndTesting.html">
 <span class="dropdown-text">Lab 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/03/reproducibility.html">
 <span class="dropdown-text">Lab 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/04/debugging.html">
 <span class="dropdown-text">Lab 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/05/code_review.html">
 <span class="dropdown-text">Lab 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-how-tos" role="button" data-bs-toggle="dropdown" aria-expanded="false">How tos</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-how-tos">    
        <li>
    <a class="dropdown-item" href="../howtos/RandRStudioInstall.html">
 <span class="dropdown-text">Installing R &amp; RStudio</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/accessingPython.html">
 <span class="dropdown-text">Accessing Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/accessingUnixCommandLine.html">
 <span class="dropdown-text">Accessing the Unix Command Line</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/gitInstall.html">
 <span class="dropdown-text">Installing Git</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/ps-submission.html">
 <span class="dropdown-text">Problem Set Submissions</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Windows</li>
        <li>
    <a class="dropdown-item" href="../howtos/windowsAndLinux.html">
 <span class="dropdown-text">Installing the Linux Subsystem on Windows</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howtos/windowsInstall.html">
 <span class="dropdown-text">Using R, RStudio, and LaTeX on Windows</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://edstem.org/us/courses/25090/discussion/">Discussion</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://statistics.berkeley.edu/computing/training/tutorials">Tutorials</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/berkeley-stat243/stat243-fall-2022"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Good practices: coding practices, debugging, and reproducible research</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit1-intro.html" class="sidebar-item-text sidebar-link">Unit 1</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit2-dataTech.html" class="sidebar-item-text sidebar-link">Unit 2</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit3-bash.html" class="sidebar-item-text sidebar-link">Unit 3</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit4-goodPractices.html" class="sidebar-item-text sidebar-link active">Unit 4</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit5-programming.html" class="sidebar-item-text sidebar-link">Unit 5</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/unit6-parallel.html" class="sidebar-item-text sidebar-link">Unit 6</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#good-coding-practices" id="toc-good-coding-practices" class="nav-link active" data-scroll-target="#good-coding-practices">1. Good coding practices</a>
  <ul class="collapse">
  <li><a href="#editors" id="toc-editors" class="nav-link" data-scroll-target="#editors">Editors</a></li>
  <li><a href="#coding-syntax" id="toc-coding-syntax" class="nav-link" data-scroll-target="#coding-syntax">Coding syntax</a></li>
  <li><a href="#coding-style" id="toc-coding-style" class="nav-link" data-scroll-target="#coding-style">Coding style</a></li>
  <li><a href="#assertions-and-testing" id="toc-assertions-and-testing" class="nav-link" data-scroll-target="#assertions-and-testing">Assertions and testing</a></li>
  <li><a href="#version-control" id="toc-version-control" class="nav-link" data-scroll-target="#version-control">Version control</a></li>
  </ul></li>
  <li><a href="#debugging-and-recommendations-for-avoiding-bugs" id="toc-debugging-and-recommendations-for-avoiding-bugs" class="nav-link" data-scroll-target="#debugging-and-recommendations-for-avoiding-bugs">2. Debugging and recommendations for avoiding bugs</a></li>
  <li><a href="#tips-for-running-analyses" id="toc-tips-for-running-analyses" class="nav-link" data-scroll-target="#tips-for-running-analyses">3. Tips for running analyses</a></li>
  <li><a href="#reproducible-research" id="toc-reproducible-research" class="nav-link" data-scroll-target="#reproducible-research">4. Reproducible research</a>
  <ul class="collapse">
  <li><a href="#some-basic-strategies" id="toc-some-basic-strategies" class="nav-link" data-scroll-target="#some-basic-strategies">Some basic strategies</a></li>
  <li><a href="#formal-tools" id="toc-formal-tools" class="nav-link" data-scroll-target="#formal-tools">Formal tools</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Good practices: coding practices, debugging, and reproducible research</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Chris Paciorek </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 29, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<p><a href="./unit4-goodPractices.pdf" class="btn btn-primary">PDF</a></p>
<p>Sources:</p>
<ul>
<li>Chambers</li>
<li>Hadley Wickham’s <a href="https://adv-r.hadley.nz/debugging.html">advanced R notes on debugging</a>.</li>
<li>Roger Peng’s <a href="https://www.biostat.jhsph.edu/~rpeng/docs/R-debug-tools.pdf">notes</a> on debugging in R</li>
<li>Murrell, Introduction to Data Technologies, Ch. 2</li>
<li><a href="http://www.jstatsoft.org/v42/i02">Journal of Statistical Software vol.&nbsp;42: 19 Ways of Looking at Statistical Software</a></li>
<li><a href="http://arxiv.org/abs/1210.0530">Wilson et at., Best practices for scientific computing, ArXiv:1210:0530</a></li>
<li><a href="https://web.stanford.edu/~gentzkow/research/CodeAndData.pdf">Gentzkow and Shapiro tutorial for social scientists</a></li>
<li><a href="https://github.com/berkeley-stat243/stat243-fall-2014/blob/master/section/millman-perez.pdf">Millman and Perez article about reproducible research</a></li>
<li><a href="https://california.degruyter.com/view/title/568658?tab_body=toc">Chapter 11 of Transparent and Reproducible Social Science Research</a></li>
</ul>
<p>This unit covers good coding/software development practices, debugging (and practices for avoiding bugs), and doing reproducible research. As in later units of the course, the material is generally not specific to R, but some details and the examples are in R.</p>
<section id="good-coding-practices" class="level1">
<h1>1. Good coding practices</h1>
<p>Some of these tips apply more to software development and some more to analyses done for specific projects; hopefully it will be clear in most cases.</p>
<section id="editors" class="level2">
<h2 class="anchored" data-anchor-id="editors">Editors</h2>
<p>Use an editor that supports the language you are using (e.g., <em>Atom</em>, <em>Emacs</em>/<em>Aquamacs</em>, <em>Sublime</em>, <em>vim</em>, <em>VSCode</em>, <em>TextMate</em>, <em>WinEdt</em>, or the built-in editor in <em>RStudio</em>). Some advantages of this can include: (1) helpful color coding of different types of syntax and of strings, (2) automatic indentation and spacing, (3) code can often be run or compiled from within the editor, (4) parenthesis matching, (5) line numbering (good for finding bugs).</p>
</section>
<section id="coding-syntax" class="level2">
<h2 class="anchored" data-anchor-id="coding-syntax">Coding syntax</h2>
<p>The files <a href="goodCode.R">goodCode.R</a> and <a href="badCode.R">badCode.R</a> in the <em>units</em> directory of the class repository provide examples of code written such that it does and does not conform to the suggestions listed in this section.</p>
<p>Here are some R-related style guides:</p>
<ul>
<li>Adler has style tips.</li>
<li>The <a href="https://style.tidyverse.org/">tidyverse style guide</a> or its offshoot <a href="https://google.github.io/styleguide/Rguide.html">Google R style</a>.</li>
<li>A <a href="http://cran.r-project.org/web/packages/rockchalk/vignettes/Rstyle.pdf">empirical style guide</a> based on the code of R Core and key package developers.</li>
<li>This <a href="http://journal.r-project.org/archive/2012-2/RJournal_2012-2_Baaaath.pdf">R journal article</a> summarizes the state of naming styles on CRAN.</li>
</ul>
<p>And here’s a summary of my own thoughts:</p>
<ul>
<li>Header information: put metainfo on the code into the first few lines of the file as comments. Include who, when, what, how the code fits within a larger program (if appropriate), possibly the versions of R and key packages that you used.</li>
<li>Indentation: do this systematically (your editor can help here). This helps you and others to read and understand the code and can help in detecting errors in your code because it can expose lack of symmetry.</li>
<li>Whitespace: use a lot of it. Some places where it is good to have it are
<ul>
<li>around operators (assignment and arithmetic);</li>
<li>between function arguments;</li>
<li>between list elements; and</li>
<li>between matrix/array indices, in particular for missing indices.</li>
</ul></li>
<li>Use blank lines to separate blocks of code and comments to say what the block does</li>
<li>Split long lines at meaningful places.</li>
<li>Use parentheses for clarity even if not needed for order of operations. For example, <code>a/y*x</code> will work but is not easy to read and you can easily induce a bug if you forget the order of ops.</li>
<li>Documentation - add lots of comments (but don’t belabor the obvious). Remember that in a few months, you may not follow your own code any better than a stranger. Some key things to document: (1) summarizing a block of code, (2) explaining a very complicated piece of code - recall our complicated regular expressions, (3) explaining arbitrary constant values.</li>
<li>For software development, break code into separate files (2000-3000 lines per file) with meaningful file names and related functions grouped within a file.</li>
<li>Choose a consistent naming style for objects and functions: e.g. <em>nIts</em> vs.&nbsp;<em>n.its</em> vs <em>numberOfIts</em> vs.&nbsp;<em>n_its</em>
<ul>
<li>This <a href="http://journal.r-project.org/archive/2012-2/RJournal_2012-2_Baaaath.pdf">R journal article</a> summarizes the state of naming styles on CRAN.</li>
<li>In object-oriented languages such as Python and Java, periods are used in the context of object-oriented programming, so I recommend not using periods in the names of your objects.</li>
</ul></li>
<li>Try to have the names be informative without being overly long.</li>
<li>Don’t overwrite names of objects/functions that already exist in R. E.g., don’t use ‘lm’. That said, the namespace system helps with the unavoidable cases where there are name conflicts.</li>
<li>Use active names for functions (e.g., <em>calcLogLik</em>, <em>calc_logLik</em> rather than <em>logLik</em> or <em>logLikCalc</em>). The idea is that a function in a programming language is like a verb in regular language (a function <em>does</em> something), so use a verb in naming it.</li>
<li>Learn from others’ code</li>
</ul>
<p>This semester, someone will be reading your code - the GSI and and me when we look at your assignments. So to help us in understanding your code and develop good habits, put these ideas into practice in your assignments.</p>
</section>
<section id="coding-style" class="level2">
<h2 class="anchored" data-anchor-id="coding-style">Coding style</h2>
<p>This is particularly focused on software development, but some of the ideas are useful for data analysis as well.</p>
<ul>
<li>Break down tasks into core units</li>
<li>Write reusable code for core functionality and keep a single copy of the code (w/ backups of course or ideally version control) so you only need to make changes to a piece of code in one place</li>
<li>Smaller functions are easier to debug, easier to understand, and can be combined in a modular fashion (like the UNIX utilities)</li>
<li>Write functions that take data as an argument and not lines of code that operate on specific data objects. Why? Functions allow us to reuse blocks of code easily for later use and for recreating an analysis (reproducible research). It’s more transparent than sourcing a file of code because the inputs and outputs are specified formally, so you don’t have to read through the code to figure out what it does.</li>
<li>Functions should:
<ul>
<li>be modular (having a single task);</li>
<li>have meaningful name; and</li>
<li>have a comment describing their purpose, inputs and outputs (see the help file for an R function of your choice for how this is done in that context).</li>
</ul></li>
<li>Write tests for each function (i.e., unit tests)</li>
<li>Don’t hard code numbers - use variables (e.g., number of iterations, parameter values in simulations), even if you don’t expect to change the value, as this makes the code more readable. For example, the speed of light is a constant in a scientific sense, but best to make it a variable in code: <code>speedOfLight &lt;- 3e8</code></li>
<li>Use R lists to keep disparate parts of related data together</li>
<li>Practice defensive programming (see also the discussion below on assertions)
<ul>
<li>check function inputs and warn users if the code will do something they might not expect or makes particular choices;</li>
<li>check inputs to <em>if</em> and the ranges in <em>for</em> loops:
<ul>
<li>use <code>seq_len()</code> and <code>seq_along()</code> instead of <code>1:n</code> in setting up for loops</li>
<li>use <code>if(isTRUE(condition))</code> in if statements in case the condition is NA (which would otherwise cause an error)</li>
</ul></li>
<li>provide reasonable default arguments;</li>
<li>document the range of valid inputs;</li>
<li>check that the output produced is valid; and</li>
<li>stop execution based on checks and give an informative error message.</li>
</ul></li>
<li>Try to avoid system-dependent code that only runs on a specific version of an OS or specific OS</li>
<li>Learn from others’ code</li>
<li>Consider rewriting your code once you know all the settings and conditions; often analyses and projects meander as we do our work and the initial plan for the code no longer makes sense and the code is no longer designed specifically for the job being done.</li>
</ul>
</section>
<section id="assertions-and-testing" class="level2">
<h2 class="anchored" data-anchor-id="assertions-and-testing">Assertions and testing</h2>
<p>Both tests and assertions are critically important for writing robust code that is less likely to contain bugs.</p>
<p>Assertions are checks in your code that the state of the program is as you expect, including arguments provided by users. In addition to simple use of <em>stopifnot()</em> and using <em>if()</em> combined with <em>stop()</em> and <em>warning()</em>, the <em>assertthat</em> and <em>assertr</em> packages provide useful tools. The <em>checkmate</em> package specifically helps in checking arguments.</p>
<p>Tests evaluate whether your code operates correctly. This can include tests that your code provides correct and useful errors when something goes wrong (so that means that a test might be to see if problematic input correctly produces an error). <em>Unit tests</em> are intended to test the behavior of small pieces (units) of code, generally individual functions. Unit tests naturally work well with the ideas above of writing small, modular functions. <em>testthat</em> and other packages are designed to make it easier to write sets of good tests.</p>
<p>In Lab 2, we’ll go over assertions and testing in detail.</p>
</section>
<section id="version-control" class="level2">
<h2 class="anchored" data-anchor-id="version-control">Version control</h2>
<ul>
<li>Use it! Even for projects that only you are working on.</li>
<li>Use an issues tracker (e.g., the GitHub issues tracker is quite nice), or at least a simple to-do file, noting changes you’d like to make in the future.</li>
<li>In addition to good commit messages, it’s a good idea to keep good running notes documenting your projects.</li>
</ul>
<p>We’ve already seen Git some and will see it in a lot more detail later in the semester, so I don’t have more to say here.</p>
</section>
</section>
<section id="debugging-and-recommendations-for-avoiding-bugs" class="level1">
<h1>2. Debugging and recommendations for avoiding bugs</h1>
<p>The <a href="http://github.com/berkeley-scf/tutorial-R-debugging">R debugging tutorial</a> has information on</p>
<ul>
<li>basic debugging strategies,</li>
<li>using R’s interactive debugging tools,</li>
<li>common causes of bugs,</li>
<li>tips and tools for avoiding bugs and catching errors, and</li>
<li>information on how to get help online.</li>
</ul>
<p>In a future Lab, we’ll go over debugging in detail, so you don’t need to look through the R debugging tutorial at this time.</p>
</section>
<section id="tips-for-running-analyses" class="level1">
<h1>3. Tips for running analyses</h1>
<p>Save your output at intermediate steps (including the random seed state) so you can restart if an error occurs or a computer fails. Using <em>save()</em> and <em>save.image()</em> to write to <em>.Rda</em> (<em>.RData</em>) files work well for this.</p>
<p>Run your code on a small subset of the problem before setting off a job that runs for hours or days. Make sure that the code works on the small subset and saves what you need properly at the end.</p>
</section>
<section id="reproducible-research" class="level1">
<h1>4. Reproducible research</h1>
<p>The idea of “reproducible research” has gained a lot of attention in the last decade because of the increasing complexity of research projects, lack of details in the published literature, failures in being able to replicate or reproduce others’ work, fraudulent research, and for other reasons.</p>
<p>We’ve seen a number of tools that can help with doing reproducible research, including version control systems such as git, the use of scripting such as bash and R scripts, and literate programming tools such as knitr and R Markdown.</p>
<p><em>Provenance</em> is becoming increasingly important in science. It basically means being able to trace the steps of an analysis back to its origins. <em>Reproducibility</em> and <em>replicability</em> are related concepts:</p>
<p><em>Reproducibility</em> - the idea is that a second person/group could get the exact same results as an existing analysis if they use the same input data, methods, and code. This can be surprisingly hard as time passes even if you’re the one attempting to reproduce things.</p>
<p><em>Replicability</em> - the idea is that a second/person could obtain results consistent with an existing analysis when using new data to answer the same scientific question.</p>
<p>Open question: What is required for something to be reproducible? What about replicable? What are the challenges in doing so?</p>
<section id="some-basic-strategies" class="level2">
<h2 class="anchored" data-anchor-id="some-basic-strategies">Some basic strategies</h2>
<ul>
<li>Have a directory for each project with subdirectories with meaningful and standardized names: e.g., <em>code</em>, <em>data</em>, <em>paper</em>. The Journal of the American Statistical Association (JASA) has a <a href="https://github.com/jasa-acs/repro-template">template GitHub repository</a> with some suggestions.</li>
<li>Have a file of code for pre-processing, one or more for analysis, and one for figure/table preparation.
<ul>
<li>The pre-processing may involve time-consuming steps. Save the output of the pre-processing as a file that can be read in to the analysis script.</li>
<li>You may want to name your files something like this, so there is an obvious ordering: “1-prep.R”, “2-analysis.R”, “3-figs.R”.</li>
<li>Have the code file for the figures produce the <strong>exact</strong> manuscript/report figures, operating on a file (e.g., .Rda file) that contains all the objects necessary to run the figure-producing code; the code producing the .Rda file should be in your analysis code file (or somewhere else sensible).</li>
<li>Alternatively, use <em>knitr</em>, <em>R Markdown,</em> or <em>Jupyter notebooks</em> for your document preparation.</li>
</ul></li>
<li>Keep a document describing your running analysis with dates in a text file (i.e., a lab book).</li>
<li>Note where data were obtained (and when, which can be helpful when publishing) and pre-processing steps in the lab book. Have data version numbers with a file describing the changes and dates (or in lab book). If possible, have all changes to data represented as code that processes the data relative to a fixed baseline dataset.</li>
<li>Note what code files do what in the lab book.</li>
<li>Keep track of the details of the system and software you are running your code under, e.g., operating system version, software (e.g., R, Python) versions, R or Python package versions, etc.
<ul>
<li>In R, <em>sessionInfo()</em> will report all this for you.</li>
</ul></li>
</ul>
</section>
<section id="formal-tools" class="level2">
<h2 class="anchored" data-anchor-id="formal-tools">Formal tools</h2>
<ol type="1">
<li>In some cases you may be able to carry out your complete workflow in a knitr/R Markdown document or in a Jupyter notebook.</li>
<li>You might consider workflow/pipeline management software such as Drake or other tools discussed in the <a href="https://cran.r-project.org/web/views/ReproducibleResearch.html">CRAN Reproducible Research Task View</a>. Alternatively, one can use the <em>make</em> tool, which is generally used for compiling code, as a tool for reproducible research: if interested, see the tutorial on <a href="http://github.com/berkeley-scf/tutorial-make-workflows">Using make for workflows</a> or this <a href="https://www.jstatsoft.org/article/view/v094c01">Journal of Statistical Software article</a> for more details.</li>
<li>You might organize your workflow as an R package as described in <a href="https://doi.org/10.1080/00031305.2017.1375986">this article</a>.</li>
<li>Package management:
<ul>
<li>R: You can manage the versions of R packages (and dependent packages) used in your project using package management packages such as <em>renv</em>, <em>checkpoint</em>, and <em>packrat</em>.</li>
<li>Python: You can manage the versions of Python packages (and dependent packages) used in your project using Conda environments (or virtualenvs).</li>
</ul></li>
<li>If your project uses multiple pieces of software (e.g., not just R or Python), you can set up a reproducible environment using <em>containers</em>, of which Docker containers are the best known. These provide something that is like a lightweight virtual machine in which you can install exactly the software (and versions) you want and then share with others. Docker container images are a key building block of various tools such as GitHub Actions and the <a href="https://mybinder.org">Binder project</a></li>
<li>You can manage the configuration of a project using the <em>config</em> package. This allows you to set configuration values that control how your code/workflow runs, thereby enabling you to run the workflow under different scenarios (e.g., different input datasets, different models, different model configurations, etc.).</li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../units/unit3-bash.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Unit 3</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../units/unit5-programming.html" class="pagination-link">
        <span class="nav-page-text">Unit 5</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>